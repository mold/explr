{"version":3,"sources":["aria-announcer.js","api/lastfm.js","search.js","api/api.js","utils.js","screenshot.js","keyboard-mode.js","no-countries.js","script.js","map.js"],"names":["announcer","LIVEREGION_TIMEOUT_DELAY","liveAnnouncer","debounce","func","wait","timeout","_len","arguments","length","args","Array","_key2","clearTimeout","setTimeout","apply","announce","message","assertiveness","undefined","LiveAnnouncer","clearAnnouncer","clear","destroyAnnouncer","destroy","_classCallCheck","this","node","document","createElement","dataset","Object","assign","style","border","clip","clipPath","height","margin","overflow","padding","position","width","whiteSpace","assertiveLog","createLog","appendChild","politeLog","body","prepend","ariaLive","setAttribute","removeChild","textContent","remove","innerHTML","api","lastfm","key","url","setKeyInfo","success","keyInfo","total","fails","keyI","keys","window","forEach","k","send","method","options","callback","retries","xhr","gotResponse","aborted","tryGet","tries","cb","avgErrors","reduce","avg","i","arr","bestKeys","_url","_key","filter","d3","json","el","replace","e","d","JSON","parse","response","error","errInfo","errorCode","try","_JSON$parse","console","warn","bind","abort","typingTimeout","superCount","utils","getCountriesData","log","promise","Promise","res","rej","csv","err","data","id","names","split","tags","mainName","tag","name","all","then","_ref","_ref2","_slicedToArray","countryData","hardcodedCountries","map","splits","concat","_objectSpread","splice","flat","alias","nest","toLowerCase","cname","getCountry","artist","hardcodedTagName","country","responseData2","demonymTag","countryTag","bestTag","toptags","theTroubles","count","some","t","tname","includes","info","getCountries","artists","checkCount","script","setLoadingStatus","SESSION","total_artists","select","html","localforage","setItem","STORED_ARTISTS","returnList","returnObject","push","Date","getTime","getTags","getArtistInfo","artistInfo","data1","tagnamelist","image","description","bio","summary","recommendationRequests","cancelRecommendationRequests","getRecommendations","recommendations","USER_TAGS","slice","userTagObj","rollup","xhr1","tagCounts","topartists","a","num","xhr2","data2","hasTags","sort","b","getFriends","screenshot","exportToCSV","countryCountObj","list","countryNames","countryCount","countryId","countryName","json2csv","_ref3","_ref4","localeCompare","fields","label","value","row","acc","playcount","replaceAll","open","encodeURI","getCountryNameFromId","match","find","getNumberOfArtistsForCountry","getCurrentData","_ref5","_toConsumableArray","values","item","hasOwnProperty","search","render","drawCenteredText","obj","ctx","font","fillText","string","w","measureText","y","lineWidth","strokeStyle","strokeText","autoDownload","explrLogo","Image","svg","attr","h","canvas","getContext","backgroundColor","getComputedStyle","textColor","color","insert","fill","selectAll","font-family","font-size","stroke","canvg","XMLSerializer","serializeToString","onload","save","globalAlpha","fillStyle","scoreString","countryScore","titleString","overlay","fillRect","restore","drawImage","getElementById","src","toDataURL","getElementsByClassName","ariaModal","download","close","dataurl","href","click","SEARCH_IS_OPEN","searchButton","filteredCountries","filteredArtists","filteredCountryArtists","noCountryArtists","filteredShortcuts","keyboardMode","getAnnouncement","artistText","announcementParts","input","querySelector","totalArtistLength","shortcutText","countryText","join","initSearch","FOCUSED_RESULT","countriesList","shortcuts","ariaExpanded","countries","onClick","clearExplrCache","location","reload","nextTheme","toggleFilter","_ref6","searchContainer","searchInputWrapper","classList","add","resultsDiv","type","placeholder","role","focus","addEventListener","shortcutsWrapper","shortcutsHeading","countriesWrapper","artistsWrapper","shortcutsWithoutStatus","shortcut","ariaLabelledby","c","searchResultWrapper","shortcutSpan","highlightedName","regex","RegExp","getLoadingStatus","countriesHeading","countrySpan","countryArtistsSpan","stopSearch","dispatchEvent","Event","artistsHeading","artistWrapper","artistCountryWrapper","srOnlyFrom","artistPlaycount","artistCountryNameSpan","addTagsSpan","searchArtist","artistNameSpan","evt","currentActiveDescendant","currentActiveElement","inputElement","keyCode","removeAttribute","scrollTop","preventDefault","nextResult","nextElementSibling","nextGroup","parentElement","scrollIntoView","behavior","block","previousResult","previousElementSibling","contains","previousGroup","resultsInGroup","querySelectorAll","lastGroup","allGroups","getAttribute","firstVisibleOption","target","closest","searchButtonClose","preventScroll","getSearchStatus","setSearchStatus","status","MIN_ZOOM_LEVEL_FOR_KEYBOARD_MODE","MAX_COUNTRY_SUGGESTIONS","KEYBOARD_MODE_ACTIVE","ALPHABET","visibleCountries","keyBuffer","keyBufferTimer","keyboardModeActive","isKeyboardModeEnabled","currentFocus","EXCLUDED_COUNTRY_IDS","handleLetterKeyPress","tagName","ctrlKey","altKey","shiftKey","metaKey","toUpperCase","index","indexOf","targetCountry","ga","hitType","eventCategory","eventAction","eventLabel","getCurrentlyVisibleCountries","userName","formattedCountries","artistCount","parseInt","letter","number","isInViewport","element","COUNTRY_BBOX_OVERRIDES","overrides","isArray","bbox","isBBoxInViewport","rect","getBoundingClientRect","rectangleLeft","innerWidth","rectangleTop","innerHeight","top","bottom","left","right","_bbox","west","south","east","north","screenCorners","coord","projected","projection","x","minX","Math","min","p","maxX","max","minY","maxY","scale","call","zoom","translate","transformedMinX","transformedMaxX","transformedMinY","transformedMaxY","displayKeyboardModeMessage","innerMessage","hideKeyboardModeMessage","getPathCenter","path","parseFloat","hasAnnounced","getVisibleCountries","countriesSelection","each","updateVisibleCountries","cleanup","center","append","text","init","move","MAX_ZOOM","param","s","centered","dismissCenteredCountry","newScale","removeEventListener","isActive","getStatus","noCountries","listOfArtistsWithNoCountry","saveToStorage","object","sortArtists","announcementIntervalId","CACHED_NO_COUNTRIES","addArtistsWithNoCountry","handleCheckboxChange","_document$querySelect","artistName","checked","artistsState","localStorage","getItem","stringify","parentNode","display","nextCheckbox","updateNoCountriesList","sortedData","noCountryArtistSortMethod","noCountriesListEl","_art","artistState","listItem","property","on","_document$querySelect2","radios","getElementsByName","sortFunction","selectedValue","_step","_iterator","_createForOfIteratorHelper","n","done","radio","f","_step2","_iterator2","showModal","dialog","event","loadingReady","loadingStatus","STORED_ARTISTS_PROMISE","val","CACHED_NO_COUNTRIES_PROMISE","CACHED_USERS","cached_users","theme","legend","getAllArtists","user","currPage","responseData","confirm","maxPage","totalPages","artistNames","newArtist","newArtistCountries","leaves","artistsFromCountry","addArtists","end","getUserTags","alert","origin","pathname","tagCount","topArtists","forbidden","taglist","lim","nogood","user_tags","random","randomcountrylist","clearInterval","existingAriaLabelledBy","loader","transition","duration","delay","substr","welcomeOverlay","_document$getElementB","innerText","_d3$select","visibility","friends","friendName","updateName","classed","_defineProperty","floor","colorArray","currentPage","itemsPerPage","currentZoom","prefersReducedMotion","matchMedia","matches","840","643","152","218","724","620","250","528","554","242","296","throttleTimer","redraw","topo","g","countryPlaylists","scaleExtent","countryDivIsOpen","mydomain","maxartists","maxplaycount","defaultTheme","updateDimensions","offsetWidth","getCountryPlaycount","numbersWithSpace","toString","updateScale","pow","E","threshold","domain","range","updateLegend","len","ceil","legend_labels","text1","enter","getComputedTextLength","_","drawPlays","closeButton","offsetL","offsetT","tooltip","infoContainer","cnameDiv","themes","blue_black","green_black","pink_black","pink_white","green_white","red_white","toTheme","themeList","bodyClass","setup","geo","naturalEarth","PI","class","draw","redrawMap","background-color","border-color","properties","getCountryCenter","offsetLeft","offsetTop","mouse","clicked","removeArtistDiv","tr","sc","animate","withKeyboard","highlightCountry","invert","showArtists","pageNumber","start","pageItems","artistDiv","data-artist","lowlight","highlight","makeSummaryDiv","showNextFive","showPreviousFive","makeArtistDiv","nameTags","tagTags","pl","linkdiv","lastFmLink","recLoadingDiv","uri","playlistName","recLoadingMessage","alt","namelist","array","j","temp","shuffleArray","art","artistimg","artistname","recoArtistDiv","artisttaglist","usertaglist","summaryText","paragraphs","z","elem","pos","offsetHeight","tagdiv","paragraph","countryElement","bounds","modscaleX","modscaleY","pt","countryTopoData","mainBBox","_bbox2","world","topojson","feature","objects","features","newArtistsByCountry","countryDict","userPrefersReducedMotion","entries","_ref7","_ref8","findIndex"],"mappings":"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","file":"../all.min.js","sourcesContent":["var announcer = {};\n\n/* Inspired by https://github.com/AlmeroSteyn/react-aria-live */\nconst LIVEREGION_TIMEOUT_DELAY = 7000;\n\nlet liveAnnouncer = null;\n\nfunction debounce(func, wait) {\n    let timeout;\n    return function executedFunction(...args) {\n        const later = () => {\n            clearTimeout(timeout);\n            func(...args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    };\n};\n\n/**\n * Announces the message using screen reader technology.\n */\nfunction announce(message, assertiveness = 'assertive', timeout = LIVEREGION_TIMEOUT_DELAY) {\n  if (!liveAnnouncer) {\n    liveAnnouncer = new LiveAnnouncer();\n  }\n\n  liveAnnouncer.announce(message, assertiveness, timeout);\n}\n\n/**\n * Stops all queued announcements.\n */\nfunction clearAnnouncer(assertiveness) {\n  if (liveAnnouncer) {\n    liveAnnouncer.clear(assertiveness);\n  }\n}\n\n/**\n * Removes the announcer from the DOM.\n */\nfunction destroyAnnouncer() {\n  if (liveAnnouncer) {\n    liveAnnouncer.destroy();\n    liveAnnouncer = null;\n  }\n}\n\nclass LiveAnnouncer {\n  constructor() {\n    this.node = document.createElement('div');\n    this.node.dataset.liveAnnouncer = 'true';\n    // copied from VisuallyHidden\n    Object.assign(this.node.style, {\n      border: 0,\n      clip: 'rect(0 0 0 0)',\n      clipPath: 'inset(50%)',\n      height: '1px',\n      margin: '-1px',\n      overflow: 'hidden',\n      padding: 0,\n      position: 'absolute',\n      width: '1px',\n      whiteSpace: 'nowrap'\n    });\n\n    this.assertiveLog = this.createLog('assertive');\n    this.node.appendChild(this.assertiveLog);\n\n    this.politeLog = this.createLog('polite');\n    this.node.appendChild(this.politeLog);\n\n    document.body.prepend(this.node);\n  }\n\n  createLog(ariaLive) {\n    let node = document.createElement('div');\n    node.setAttribute('role', 'log');\n    node.setAttribute('aria-live', ariaLive);\n    node.setAttribute('aria-relevant', 'additions');\n    return node;\n  }\n\n  destroy() {\n    if (!this.node) {\n      return;\n    }\n\n    document.body.removeChild(this.node);\n    this.node = null;\n  }\n\n  announce(message, assertiveness = 'assertive', timeout = LIVEREGION_TIMEOUT_DELAY) {\n    if (!this.node) {\n      return;\n    }\n\n    let node = document.createElement('div');\n    node.textContent = message;\n\n    if (assertiveness === 'assertive') {\n      this.assertiveLog.appendChild(node);\n    } else {\n      this.politeLog.appendChild(node);\n    }\n\n    if (message !== '') {\n      setTimeout(() => {\n        node.remove();\n      }, timeout);\n    }\n  }\n\n  clear(assertiveness) {\n    if (!this.node) {\n      return;\n    }\n\n    if (!assertiveness || assertiveness === 'assertive') {\n      this.assertiveLog.innerHTML = '';\n    }\n\n    if (!assertiveness || assertiveness === 'polite') {\n      this.politeLog.innerHTML = '';\n    }\n  }\n}\n\nannouncer.announce = announce;\nannouncer.clearAnnouncer = clearAnnouncer;\nannouncer.destroyAnnouncer = destroyAnnouncer;\nannouncer.debounce = debounce;","var api = api || {};\n\napi.lastfm = {};\napi.lastfm.key = \"865b1653dbe200905a5b75d9d839467a\";\napi.lastfm.url = \"https://ws.audioscrobbler.com/2.0/\";\n\n(function (api) {\n\tlet keyI = 0;\n\tlet keys = [\n\t\t// https://gitlab.gnome.org/World/lollypop/blob/master/lollypop/lastfm.py\n\t\t\"7a9619a850ccf7377c46cf233c51e3c6\",\n\t\t\n\t\t// https://github.com/ampache/ampache/issues/1694\n\t\t\"13893ba930c63b1b2cbe21441dc7f550\",\n\n\t\t// https://www.reddit.com/r/lastfm/comments/3okkij/cant_create_lastfm_api_key/\n\t\t\"4cb074e4b8ec4ee9ad3eb37d6f7eb240\",\n\n\t\t// https://www.w3resource.com/API/last.fm/tutorial.php\n\t\t\"4a9f5581a9cdf20a699f540ac52a95c9\",\n\n\t\t// https://www.reddit.com/r/lastfm/comments/3l3cae/cant_get_a_lastfm_api_key/\n\t\t\"57ee3318536b23ee81d6b27e36997cde\",\n\n\t\t// original explr api key\n\t\t\"865b1653dbe200905a5b75d9d839467a\",\n\n\t\t// https://www.w3resource.com/API/last.fm/example.html\n\t\t\"68b2125fd8f8fbadeb2195e551f32bc4\",\n\n\t\t// https://rstudio-pubs-static.s3.amazonaws.com/236264_81312ba4d795474c8641dd0e2af83cba.html\n\t\t\"1ba315d4d1673bbf88aed473f1917306\"\n\t];\n\tlet keyInfo = window.keyInfo = {};\n\tkeys.forEach(k => keyInfo[k] = { success: 0, fails: 0, total: 0 });\n\n\tlet rotateKey = function () {\n\t\tlet avgErrors = keys.reduce((avg, k, i, arr) => avg + keyInfo[k].fails / arr.length, 0);\n\t\tlet bestKeys = keys.filter(k => keyInfo[k].fails <= avgErrors);\n\t\tbestKeys = bestKeys.length ? bestKeys : keys;\n\t\tlet key = bestKeys[++keyI % bestKeys.length];\n\n\t\t// console.log({ key, avgErrors, bestKeys });\n\n\t\treturn key;\n\t}\n\n\tlet setKeyInfo = function (key, success) {\n\t\tkeyInfo[key].total++;\n\t\tkeyInfo[key].success += success ? 1 : 0;\n\t\tkeyInfo[key].fails += success ? 0 : 1;\n\t}\n\n\t/**\n\t* Send an API call to last.fm\n\t* @param {String} method    The method name (e.g. \"library.getartists\")\n\t* @param {Array} options    An array of tuples (arrays with two elements)\n\t                            with options for the request: [\"key\", \"value\"]\n\t* @param {Function} callback    The callback function to call with the data\n\t                                returned from the request. Takes two arguments,\n\t                                error and data (callback(error, data))\n\t*/\n\tapi.lastfm.send = function (method, options, callback, retries) {\n\t\tlet getUrl = (apiKey) => {\n\t\t\tlet _url = api.lastfm.url + \"?\" + \"method=\" + method + \"&api_key=\" +\n\t\t\t\tapiKey + \"&format=json\";\n\n\t\t\toptions.forEach(function (el) {\n\t\t\t\t_url += \"&\" + el[0] + \"=\" +\n\t\t\t\t\t(el[1] + \"\")\n\t\t\t\t\t.replace(\"&\", \"%26\")\n\t\t\t\t\t.replace(\"/\", \"%2F\")\n\t\t\t\t\t.replace(\"+\", \"%2B\")\n\t\t\t\t\t.replace(\"\\\\\", \"%5C\");\n\t\t\t});\n\n\t\t\treturn _url;\n\t\t};\n\n\t\tretries = undefined === retries ? 10 : retries\n\t\tlet xhr, gotResponse, aborted = false;\n\n\t\tfunction tryGet(tries, cb) {\n\t\t\tlet _key = rotateKey();\n\t\t\txhr = d3.json(getUrl(_key), function (e, d) {\n\t\t\t\tif (aborted) {\n\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e) { // we got an actual server error: 4xx, 5xx\n\t\t\t\t\td = JSON.parse(e.response);\n\t\t\t\t\t// now e and d are the same\n\t\t\t\t} else if (d.error) {\n\t\t\t\t\t// we got 200 BUT it's an error\n\t\t\t\t\te = d;\n\t\t\t\t}\n\n\t\t\t\tif (e) {\n\t\t\t\t\tsetKeyInfo(_key, false);\n\n\t\t\t\t\tlet errInfo = {\n\t\t\t\t\t\tmethod: method,\n\t\t\t\t\t\terrorCode: e && e.error,\n\t\t\t\t\t\ttry: tries,\n\t\t\t\t\t\toptions: options,\n\t\t\t\t\t\tkey: _key,\n\t\t\t\t\t\tmessage: e.message || JSON.parse(e.response)?.message,\n\t\t\t\t\t};\n\t\t\t\t\t// alert(\"ERROR\");\n\t\t\t\t\tif (tries < retries) {\n\t\t\t\t\t\tconsole.warn(\"Retry request: \", errInfo);\n\t\t\t\t\t\tsetTimeout(tryGet.bind(null, tries + 1, cb), tries * 3000);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tries >= retries) {\n\t\t\t\t\t\tconsole.warn(\"Retry failed after \" + retries + \" attempts, will stop trying.\", errInfo);\n\t\t\t\t\t\tclearTimeout(timeout);\n\t\t\t\t\t\taborted = true;\n\t\t\t\t\t\te = \"ERROR\";\n\t\t\t\t\t\td = {\n\t\t\t\t\t\t\terror: \"Took to long to respond\"\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tsetKeyInfo(_key, true);\n\t\t\t\t}\n\n\t\t\t\tgotResponse = true;\n\t\t\t\tcb(e, d);\n\t\t\t});\n\t\t}\n\n\t\ttryGet(0, callback);\n\n\t\t// Abort if the request takes too long - it sometimes ballar ur and fails after a minute :(\n\t\tlet timeout = setTimeout(function () {\n\t\t\tif (!gotResponse) {\n\t\t\t\t//console.log(\"GET \" + url + \" took to long, aborting\");\n\t\t\t\txhr.abort();\n\t\t\t\tcallback(\"ERROR\", {\n\t\t\t\t\terror: \"Took to long to respond\"\n\t\t\t\t});\n\t\t\t}\n\t\t}, 20000);\n\n\t\treturn {\n\t\t\tabort: function () {\n\t\t\t\taborted = true;\n\t\t\t\txhr.abort();\n\t\t\t}\n\t\t};\n\t}\n\n})(api);","/* requires:\napi/api.js\nutils.js\nscreenshot.js\naria-announcer.js\n*/\n\nconst search = search || {};\n\nlet typingTimeout;\n\nlet SEARCH_IS_OPEN = false;\n\nlet searchButton = null;\n\nlet filteredCountries = [];\nlet filteredArtists = [];\nlet filteredCountryArtists = [];\nlet noCountryArtists = [];\nlet filteredShortcuts = [];\n\n(function () {\n\n    // Function to generate screen reader feedback text for current search results\n    search.getAnnouncement = function () {\n        let announcementParts = [];\n\n        const input = document.querySelector('input.search');\n        \n        const totalArtistLength = filteredArtists.slice(0, 100).length + filteredCountryArtists.slice(0, 100).length + noCountryArtists.slice(0, 100).length;\n    \n        if (filteredShortcuts.length > 0 && input.value.length > 3) {\n            let shortcutText = filteredShortcuts.length === 1 ? 'shortcut' : 'shortcuts';\n            announcementParts.push(`${filteredShortcuts.length} ${shortcutText}`);\n        }\n    \n        if (filteredCountries.slice(0, 5).length > 0 && input.value.length > 1) {\n            let countryText = filteredCountries.length === 1 ? 'country' : 'countries';\n            announcementParts.push(`${filteredCountries.length} ${countryText}`);\n        }\n    \n        if (totalArtistLength && input.value.length > 1) {\n            let artistText = totalArtistLength === 1 ? 'artist' : 'artists';\n            announcementParts.push(`${totalArtistLength} ${artistText}`);\n        }\n        \n    \n        let announcement = '';\n        if (announcementParts.length > 0) {\n            announcement = 'Showing ' + announcementParts.slice(0, -1).join(', ') + (announcementParts.length > 1 ? ' and ' : '') + announcementParts.slice(-1) + ', press down arrow to go to results';\n        } else {\n            announcement = 'No results found';\n        }\n        return announcement;\n      }\n\n    search.initSearch = function () {  \n\n    SEARCH_IS_OPEN = true;\n\n    let FOCUSED_RESULT = null;\n\n    let countriesList = null;\n\n    const searchButton = document.querySelector('#search-button');\n    if (searchButton) searchButton.ariaExpanded = true;\n\n    api.getCountriesData().then(countries => {\n        // countries is the array of country data\n        // You can process the countries data here\n        countriesList = countries;\n      }).catch(error => {\n        // Handle any errors here\n        console.error(error);\n      });\n\n    // List of shortcuts that you can match against\n    const shortcuts = [\n        { name: \"Status\", onClick: () => { } },\n        { name: \"Clear cached users\", onClick: () => { clearExplrCache().then(()=>window.location.reload()) } },\n        { name: \"Change user\", onClick: () => { window.location = \"./\" } },\n        { name: \"Change theme\", onClick: () => {map.nextTheme()} },\n        { name: \"Download screenshot of map\", onClick: () => {screenshot.render(true)} },\n        { name: \"Export data\", onClick: () => {utils.exportToCSV(script.getCurrentData())} },\n        { name: \"Map: Toggle between artists or scrobbles\", onClick: () => { map.toggleFilter() } },\n        { name: \"Support Explr on BuyMeACoffee\", onClick: () => { window.open('https://www.buymeacoffee.com/explrfm', '_blank'); } },\n        { name: \"View Explr on GitHub\", onClick: () => { window.open('https://github.com/mold/explr', '_blank'); } },\n    ];\n    \n    // Get the current data\n    let data = script.getCurrentData();\n\n    // Flatten and prepare the data\n    let artists = [].concat(...Object.values(data));\n    artists = artists.reduce((acc, item) => {\n        for (let key in item) {\n            if (item.hasOwnProperty(key)) {\n                acc = acc.concat(item[key]);\n            }\n        }\n        return acc;\n    }, [])\n\n    // Sort the artists by playcount\n    artists = artists.sort((a, b) => b.playcount - a.playcount);\n\n    // Create a div to hold the search field\n    let searchContainer = document.getElementById('search-container');\n    searchContainer.classList.add(\"search-container\")\n    const searchInputWrapper = document.createElement('div');\n    searchInputWrapper.classList.add(\"search-input-wrapper\")\n    let input = document.createElement('input');\n    input.type = 'text';\n    input.classList.add(\"search\")\n    input.placeholder = 'Search for an artist or a country';\n    input.setAttribute('aria-label', 'Search for an artist or a country');\n    input.setAttribute('aria-autocomplete', 'list');\n    input.setAttribute('aria-controls', 'search-results');\n    input.setAttribute('aria-expanded', 'false');\n    input.role = 'combobox';\n    searchInputWrapper.appendChild(input);\n    searchContainer.appendChild(searchInputWrapper);\n    setTimeout(() => {\n        input.focus();\n    }, 50);\n\n    // Create a div to display the results\n    let resultsDiv = document.createElement('div');\n    resultsDiv.classList.add(\"search-results\")\n    resultsDiv.id = 'search-results';\n    resultsDiv.setAttribute('role', 'listbox');\n    resultsDiv.setAttribute('aria-label', 'Search results');\n    searchContainer.appendChild(resultsDiv);\n    \n    // Add an event listener to the input field\n    input.addEventListener('input', function() {\n        // Clear the previous results\n        resultsDiv.innerHTML = '';\n\n        input.setAttribute('aria-expanded', 'true');\n\n        const shortcutsWithoutStatus = shortcuts.filter(shortcut => shortcut.name !== \"Status\");\n\n        // Filter the shortcuts based on the user's input\n            filteredShortcuts = shortcutsWithoutStatus.filter(shortcut => \n                input.value.toLowerCase() === \"shortcuts\" || \n                shortcut.name.toLowerCase().includes(input.value.toLowerCase())\n            );\n            if (filteredShortcuts.length > 0 && input.value.length > 3) {\n            const shortcutsWrapper = document.createElement('ul');\n            let shortcutsHeading = document.createElement('li');\n            shortcutsHeading.textContent = 'Explr.fm shortcuts';\n            shortcutsHeading.id = 'shortcuts-heading';\n            shortcutsHeading.role = \"presentation\"\n            shortcutsHeading.classList.add('search-result-heading');\n            shortcutsWrapper.appendChild(shortcutsHeading);\n            shortcutsWrapper.setAttribute('role', 'group');\n            shortcutsWrapper.classList.add('search-result-group');\n            shortcutsWrapper.ariaLabelledby = 'shortcuts-heading';\n            resultsDiv.appendChild(shortcutsWrapper);\n        \n            filteredShortcuts.forEach(c => {\n                if (input.value.length > 3) {\n                    if (c.name === \"Status\") {\n                        shortcutsHeading.textContent = 'Explr.fm status';\n                    }\n                    let searchResultWrapper = document.createElement('div');\n                    searchResultWrapper.classList.add('result-wrapper');\n                    searchResultWrapper.role = 'option';\n                    searchResultWrapper.id = `shortcut-${c.name.replace(/\\s+/g, '-').toLowerCase()}`;\n                    searchResultWrapper.addEventListener('click', function() {\n                        c.onClick();\n                    });\n                    const shortcutSpan = document.createElement('span');\n                    shortcutSpan.classList.add('shortcut-name');\n        \n                    // Highlight the matching letters\n                    let regex = new RegExp(input.value, 'gi');\n                    const shortcutName = c.name === \"Status\" ? script.getLoadingStatus() : c.name\n                    let highlightedName = shortcutName.replace(regex, match => `<span class=\"highlight\">${match}</span>`);\n                    shortcutSpan.innerHTML = highlightedName;\n        \n                    searchResultWrapper.appendChild(shortcutSpan);\n                    shortcutsWrapper.appendChild(searchResultWrapper);\n                }\n            });\n        }\n\n        // Filter the countries based on the user's input\n        filteredCountries = countriesList.filter(country => \n            country.names.some(name => name.toLowerCase().includes(input.value.toLowerCase()))\n        );\n\n        // Display the filtered countries\n        if (filteredCountries.length > 0 && input.value.length > 1) {\n            const countriesWrapper = document.createElement('ul');\n            let countriesHeading = document.createElement('li');\n            countriesHeading.textContent = 'Countries';\n            countriesHeading.classList.add('search-result-heading');\n            countriesHeading.id = 'countries-heading';\n            countriesHeading.role = \"presentation\"\n            countriesWrapper.appendChild(countriesHeading);\n            countriesWrapper.setAttribute('role', 'group');\n            countriesWrapper.classList.add('search-result-group');\n            countriesWrapper.setAttribute(\"aria-labelledby\", \"countries-heading\");\n            resultsDiv.appendChild(countriesWrapper);\n\n            filteredCountries.slice(0, 5).forEach(c => {\n                if (input.value.length > 1) {\n                    let searchResultWrapper = document.createElement('div');\n                    searchResultWrapper.classList.add('result-wrapper', 'country');                    searchResultWrapper.role = 'option';\n                    searchResultWrapper.id = `country-${c.name.replace(/\\s+/g, '-').toLowerCase()}`;                    // Zoom into the country on click\n                    searchResultWrapper.addEventListener('click', function() {\n                        search.stopSearch();\n                        const country = document.querySelector(`.country#c${c.id}`);\n                        if (country) {\n                            country.dispatchEvent(new Event('click'));\n                            setTimeout(() => {\n                                document.querySelector('#cnameCont h1').setAttribute(\"tabindex\", \"-1\");\n                                document.querySelector('#cnameCont h1').focus();\n                            }, 250);\n                        }\n                    });\n                    const countrySpan = document.createElement('span');\n\n                    countrySpan.classList.add('country-name');\n                    const countryArtistsSpan = document.createElement('span');\n                    countryArtistsSpan.classList.add('country-artist-count');\n                    countryArtistsSpan.textContent = `${utils.getNumberOfArtistsForCountry(c.id)} artists`;\n\n                    // Highlight the matching letters\n                    let regex = new RegExp(input.value, 'gi');\n                    let highlightedName = c.name.replace(regex, match => `<span class=\"highlight\">${match}</span>`);\n                    countrySpan.innerHTML = highlightedName;\n\n                    searchResultWrapper.appendChild(countrySpan);\n                    searchResultWrapper.appendChild(countryArtistsSpan);\n                    countriesWrapper.appendChild(searchResultWrapper);\n                }\n            });\n        }\n\n        // Filter the artists based on the user's input\n        filteredArtists = artists.filter(country => country.artist.toLowerCase().includes(input.value.toLowerCase()));\n\n        if (filteredArtists.length > 0 && input.value.length > 1) {\n            const artistsWrapper = document.createElement('ul');\n            artistsWrapper.classList.add('search-result-group');\n            let artistsHeading = document.createElement('li');\n            artistsHeading.textContent = 'Artists';\n            artistsHeading.role = \"presentation\"\n            artistsHeading.classList.add('search-result-heading');\n            artistsHeading.id = 'artists-heading';\n            artistsWrapper.appendChild(artistsHeading);\n            artistsWrapper.setAttribute('role', 'group');\n            artistsWrapper.setAttribute(\"aria-labelledby\", \"artists-heading\");\n            resultsDiv.appendChild(artistsWrapper);\n        \n            filteredArtists.slice(0, 100).forEach(artist => {\n                if (input.value.length > 1) {\n                    let searchResultWrapper = document.createElement('div');\n                    searchResultWrapper.classList.add('result-wrapper');\n                    searchResultWrapper.role = 'option';\n                    searchResultWrapper.id = `artist-${artist.artist.replace(/\\s+/g, '-').toLowerCase()}`;\n            \n                    // Navigate to the artist's last.fm link on click\n                    searchResultWrapper.addEventListener('click', function() {\n                        search.stopSearch();\n                        if (!utils.getCountryNameFromId(artist.id)) {\n                            window.open(artist.url, '_blank');\n                        }\n                        const country = document.querySelector(`.country#c${artist.id}`);\n                        if (country) {\n                            country.dispatchEvent(new Event('click'));\n                            setTimeout(() => {\n                                map.searchArtist(artist.artist);\n                            }, 250);\n                        }\n                    });\n            \n                    let artistWrapper = document.createElement('span');\n                    artistWrapper.classList.add('artist-wrapper');\n                    let artistCountryWrapper = document.createElement('span');\n                    artistCountryWrapper.classList.add('country-wrapper');\n                    const srOnlyFrom = document.createElement('span');\n                    srOnlyFrom.classList.add('visually-hidden');\n                    srOnlyFrom.textContent = ', from ';\n                    let artistPlaycount = document.createElement('span');\n                    artistPlaycount.classList.add('playcount');\n                    artistPlaycount.textContent = `${artist.playcount} scrobbles`\n                    const artistNameSpan = document.createElement('span');\n                    artistNameSpan.classList.add('artist-name');\n            \n                    // Highlight the matching letters\n                    let regex = new RegExp(input.value, 'gi');\n                    let highlightedName = artist.artist.replace(regex, match => `<span class=\"highlight\">${match}</span>`);\n                    artistNameSpan.innerHTML = highlightedName;\n            \n                    artistWrapper.appendChild(artistNameSpan);\n                    artistWrapper.appendChild(artistPlaycount);\n                    const artistCountryNameSpan = document.createElement('span');\n                    artistCountryNameSpan.classList.add('country-name');\n                    artistCountryNameSpan.textContent = utils.getCountryNameFromId(artist.id) ? utils.getCountryNameFromId(artist.id) : 'Unknown country :-(';\n                    artistCountryWrapper.appendChild(artistCountryNameSpan);\n                    artistCountryWrapper.prepend(srOnlyFrom);\n                    // Check if the country is known\n                    let countryName = utils.getCountryNameFromId(artist.id);\n                    if (!countryName) {\n                        countryName = 'Unknown country';\n                        let addTagsSpan = document.createElement('span');\n                        addTagsSpan.classList.add('add-tags');\n                        addTagsSpan.textContent = 'Go add some tags on Last.fm!';\n                        artistCountryWrapper.appendChild(addTagsSpan);\n                    }\n                    searchResultWrapper.appendChild(artistWrapper);\n                    searchResultWrapper.appendChild(artistCountryWrapper);\n                    artistsWrapper.appendChild(searchResultWrapper);\n                    artistsWrapper.classList.add('artists-wrapper');\n                }\n            });\n        }\n\n        // Filter the artists for the currently shown country\n        filteredCountryArtists = artists.filter((artist) => filteredCountries.length === 1 && filteredCountries[0].id === artist.id);\n        if (filteredCountryArtists.length > 0 && input.value.length > 1) {\n            const artistsWrapper = document.createElement('ul');\n            artistsWrapper.classList.add('search-result-group');\n            let artistsHeading = document.createElement('li');\n            artistsHeading.textContent = 'Artists from ' + filteredCountries[0].name;\n            artistsHeading.role = \"presentation\"\n            artistsHeading.classList.add('search-result-heading');\n            artistsHeading.id = 'artists-country-heading';\n            artistsWrapper.appendChild(artistsHeading);\n            artistsWrapper.setAttribute('role', 'group');\n            artistsWrapper.setAttribute(\"aria-labelledby\", \"artists-country-heading\");\n            resultsDiv.appendChild(artistsWrapper);\n        \n            filteredCountryArtists.slice(0, 100).forEach(artist => {\n                if (input.value.length > 1) {\n                    let searchResultWrapper = document.createElement('div');\n                    searchResultWrapper.classList.add('result-wrapper');\n                    searchResultWrapper.role = 'option';\n                    searchResultWrapper.id = `${filteredCountries[0].name}-artist-${artist.artist.replace(/\\s+/g, '-').toLowerCase()}`;                    \n                    searchResultWrapper.addEventListener('click', function() {\n                        search.stopSearch();\n                        const country = document.querySelector(`.country#c${artist.id}`);\n                        if (country) {\n                            country.dispatchEvent(new Event('click'));\n                            setTimeout(() => {\n                                map.searchArtist(artist.artist);\n                            }, 250);\n                        }\n                        \n                    });\n                    let artistWrapper = document.createElement('span');\n                    artistWrapper.classList.add('artist-wrapper');\n                    let artistCountryWrapper = document.createElement('span');\n                    artistCountryWrapper.classList.add('country-wrapper');\n                    const srOnlyFrom = document.createElement('span');\n                    srOnlyFrom.classList.add('visually-hidden');\n                    srOnlyFrom.textContent = ', from ';\n                    let artistPlaycount = document.createElement('span');\n                    artistPlaycount.classList.add('playcount');\n                    artistPlaycount.textContent = `${artist.playcount} scrobbles`\n                    const artistNameSpan = document.createElement('span');\n                    artistNameSpan.classList.add('artist-name');\n        \n                    // Highlight the matching letters\n                    let regex = new RegExp(input.value, 'gi');\n                    let highlightedName = artist.artist.replace(regex, match => `<span class=\"highlight\">${match}</span>`);\n                    artistNameSpan.innerHTML = highlightedName;\n        \n                    artistWrapper.appendChild(artistNameSpan);\n                    artistWrapper.appendChild(artistPlaycount);\n                    artistCountryWrapper.textContent = utils.getCountryNameFromId(artist.id);\n                    artistCountryWrapper.prepend(srOnlyFrom);\n                    searchResultWrapper.appendChild(artistWrapper);\n                    searchResultWrapper.appendChild(artistCountryWrapper);\n                    artistsWrapper.appendChild(searchResultWrapper);\n                    artistsWrapper.classList.add('artists-wrapper');\n                }\n            });\n        }\n\n        // Show artists without country when the user types \"unknown\"\n        noCountryArtists = artists.filter((artist) => \n            input.value.toLowerCase() === \"unknown\" && \n            !artist.id\n        );\n\n        if (noCountryArtists.length > 0 && input.value.length > 1) {\n            const artistsWrapper = document.createElement('ul');\n            artistsWrapper.classList.add('search-result-group');\n            let artistsHeading = document.createElement('li');\n            artistsHeading.textContent = 'Artists without a country (first 100)';\n            artistsHeading.role = \"presentation\"\n            artistsHeading.classList.add('search-result-heading');\n            artistsHeading.id = 'unknown-artists-heading';\n            artistsWrapper.appendChild(artistsHeading);\n            artistsWrapper.setAttribute('role', 'group');\n            artistsWrapper.setAttribute(\"aria-labelledby\", \"unknown-artists-heading\");\n            resultsDiv.appendChild(artistsWrapper);\n        \n            noCountryArtists.slice(0, 100).forEach(artist => {\n                if (input.value.length > 1) {\n                    let searchResultWrapper = document.createElement('div');\n                    searchResultWrapper.classList.add('result-wrapper');\n                    searchResultWrapper.role = 'option';\n                    searchResultWrapper.id = `artist-${artist.artist.replace(/\\s+/g, '-').toLowerCase()}`;\n            \n                    // Navigate to the artist's last.fm link on click\n                    searchResultWrapper.addEventListener('click', function() {\n                        search.stopSearch();\n                        if (!utils.getCountryNameFromId(artist.id)) {\n                            window.open(artist.url, '_blank');\n                        }\n                        const country = document.querySelector(`.country#c${artist.id}`);\n                        if (country) {\n                            country.dispatchEvent(new Event('click'));\n                            setTimeout(() => {\n                                map.searchArtist(artist.artist);\n                            }, 250);\n                        }\n                    });\n            \n                    let artistWrapper = document.createElement('span');\n                    artistWrapper.classList.add('artist-wrapper');\n                    let artistCountryWrapper = document.createElement('span');\n                    artistCountryWrapper.classList.add('country-wrapper');\n                    const srOnlyFrom = document.createElement('span');\n                    srOnlyFrom.classList.add('visually-hidden');\n                    srOnlyFrom.textContent = ', from ';\n                    let artistPlaycount = document.createElement('span');\n                    artistPlaycount.classList.add('playcount');\n                    artistPlaycount.textContent = `${artist.playcount} scrobbles`\n                    const artistNameSpan = document.createElement('span');\n                    artistNameSpan.classList.add('artist-name');\n            \n                    // Highlight the matching letters\n                    let regex = new RegExp(input.value, 'gi');\n                    let highlightedName = artist.artist.replace(regex, match => `<span class=\"highlight\">${match}</span>`);\n                    artistNameSpan.innerHTML = highlightedName;\n            \n                    artistWrapper.appendChild(artistNameSpan);\n                    artistWrapper.appendChild(artistPlaycount);\n                    const artistCountryNameSpan = document.createElement('span');\n                    artistCountryNameSpan.classList.add('country-name');\n                    artistCountryNameSpan.textContent = utils.getCountryNameFromId(artist.id) ? utils.getCountryNameFromId(artist.id) : 'Unknown country :-(';\n                    artistCountryWrapper.appendChild(artistCountryNameSpan);\n                    artistCountryWrapper.prepend(srOnlyFrom);\n                    // Check if the country is known\n                    let countryName = utils.getCountryNameFromId(artist.id);\n                    if (!countryName) {\n                        countryName = 'Unknown country';\n                        let addTagsSpan = document.createElement('span');\n                        addTagsSpan.classList.add('add-tags');\n                        addTagsSpan.textContent = 'Go add some tags on Last.fm!';\n                        artistCountryWrapper.appendChild(addTagsSpan);\n                    }\n                    searchResultWrapper.appendChild(artistWrapper);\n                    searchResultWrapper.appendChild(artistCountryWrapper);\n                    artistsWrapper.appendChild(searchResultWrapper);\n                    artistsWrapper.classList.add('artists-wrapper');\n                }\n            });\n        }\n\n        // Announce the number of results to screen readers\n        clearTimeout(typingTimeout);\n        typingTimeout = setTimeout(() => {\n            announcer.announce(search.getAnnouncement(), 'polite');\n        }, 750);\n    });\n\n    window.addEventListener(\"keydown\", function (evt) {\n        const inputElement = document.querySelector('.search');\n\n        // if backspace or letter key, we clear the focused result\n        if (FOCUSED_RESULT && (evt.keyCode === 8 || (evt.keyCode >= 65 && evt.keyCode <= 90))) {\n            FOCUSED_RESULT.removeAttribute(\"aria-selected\")\n            FOCUSED_RESULT.classList.remove('focused');\n            inputElement.removeAttribute('aria-activedescendant');\n            FOCUSED_RESULT = null;\n            // scroll result list to top\n            resultsDiv.scrollTop = 0;\n        }\n\n        // If arrow down, we set aria-activedescentant to the next result\n        if (evt.keyCode === 40 && SEARCH_IS_OPEN) {\n            evt.preventDefault();\n            if (FOCUSED_RESULT) {\n                FOCUSED_RESULT.removeAttribute(\"aria-selected\")\n                FOCUSED_RESULT.classList.remove('focused');\n                inputElement.removeAttribute('aria-activedescendant');\n                let nextResult = FOCUSED_RESULT.nextElementSibling;\n                if (!nextResult) {\n                    // If there's no next sibling, find the next group and select the first result in it\n                    let nextGroup = FOCUSED_RESULT.parentElement.nextElementSibling;\n                    if (nextGroup) {\n                        nextResult = nextGroup.querySelector('.result-wrapper');\n                    }\n                }\n                FOCUSED_RESULT = nextResult;\n                if (FOCUSED_RESULT) {\n                    FOCUSED_RESULT.classList.add('focused');\n                    FOCUSED_RESULT.setAttribute(\"aria-selected\", \"true\")\n                    inputElement.setAttribute('aria-activedescendant', FOCUSED_RESULT.id);\n                    FOCUSED_RESULT.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n                }\n            } else {\n                FOCUSED_RESULT = document.querySelector('.result-wrapper');\n                FOCUSED_RESULT.classList.add('focused');\n                FOCUSED_RESULT.setAttribute(\"aria-selected\", \"true\")\n                inputElement.setAttribute('aria-activedescendant', FOCUSED_RESULT.id);\n                FOCUSED_RESULT.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n            }\n        }\n\n        // If arrow up, we set aria-activedescentant to the previous result\n        if (evt.keyCode === 38 && SEARCH_IS_OPEN) {\n            evt.preventDefault();\n            if (FOCUSED_RESULT) {\n                FOCUSED_RESULT.classList.remove('focused');\n                FOCUSED_RESULT.removeAttribute(\"aria-selected\")\n                inputElement.removeAttribute('aria-activedescendant');\n                let previousResult = FOCUSED_RESULT.previousElementSibling.classList.contains('search-result-heading') ? null : FOCUSED_RESULT.previousElementSibling;\n                if (!previousResult) {\n                    // If there's no previous sibling, find the previous group and select the last result in it\n                    let previousGroup = FOCUSED_RESULT.parentElement.previousElementSibling;\n                    if (previousGroup) {\n                        let resultsInGroup = previousGroup.querySelectorAll('.result-wrapper');\n                        previousResult = resultsInGroup[resultsInGroup.length - 1];\n                    } else {\n                        // If there's no previous group, find the last group and select the last result in it\n                        let allGroups = document.querySelectorAll('.search-result-group');\n                        let lastGroup = allGroups[allGroups.length - 1];\n                        if (lastGroup) {\n                            let resultsInGroup = lastGroup.querySelectorAll('.result-wrapper');\n                            previousResult = resultsInGroup[resultsInGroup.length - 1];\n                        }\n                        \n                    }\n                }\n                FOCUSED_RESULT = previousResult;\n                if (FOCUSED_RESULT) {\n                    FOCUSED_RESULT.classList.add('focused');\n                    FOCUSED_RESULT.setAttribute(\"aria-selected\", \"true\")\n                    inputElement.setAttribute('aria-activedescendant', FOCUSED_RESULT.id);\n                    FOCUSED_RESULT.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n                }\n            }\n        }\n\n        // If enter, activate the focused result\n        if (evt.keyCode === 13 && SEARCH_IS_OPEN) {\n            evt.preventDefault();\n            const currentActiveDescendant = inputElement.getAttribute('aria-activedescendant');\n            // If the user has selected a result\n            if (currentActiveDescendant) {\n                const currentActiveElement = document.getElementById(currentActiveDescendant);\n                if (currentActiveElement) {\n                    currentActiveElement.dispatchEvent(new Event('click'));\n                }\n            }\n            else {\n                console.log('no active descendant');\n                // Select the first visible option\n                const firstVisibleOption = document.querySelector('.result-wrapper');\n                // If the first visible option exists\n                if (firstVisibleOption) {\n                    // Trigger a click event on the first visible option\n                    firstVisibleOption.dispatchEvent(new Event('click'));\n                }\n            }\n        }\n        \n        // If escape, close the search\n        if (evt.keyCode === 27 && SEARCH_IS_OPEN) {\n            search.stopSearch();\n        }\n\n    });\n\n    // Set up click outside listener for search\n    window.addEventListener(\"click\", function (evt) {\n        if (SEARCH_IS_OPEN && !evt.target.closest('.search-container')) {\n            search.stopSearch();\n        }\n    });\n\n  }\n\n\n\n  search.stopSearch = function () {\n    const searchButtonClose = document.querySelector('#search-button');\n    const inputElement = document.querySelector('.search');\n    if (inputElement !== undefined) {\n        inputElement.removeAttribute('aria-activedescendant');\n        inputElement.setAttribute('aria-expanded', 'false');\n    }\n    const searchContainer = document.querySelector('.search-container');\n    if (searchContainer) searchContainer.innerHTML = '';\n    if (searchButtonClose){\n        searchButtonClose.focus( {preventScroll: true} ); \n        searchButtonClose.ariaExpanded = false;\n    };\n    SEARCH_IS_OPEN = false;\n  }\n  search.getSearchStatus = function () {\n    return SEARCH_IS_OPEN;\n  }\n\n  search.setSearchStatus = function (status) {\n    SEARCH_IS_OPEN = status;\n  }\n\n  window.initSearch = search.initSearch;\n\n})();","/*requires:\napi/lastfm.js\n*/\n\nvar api = api || {};\nvar superCount = 0;\n\n(function (window, document) {\n\tlet getHardcodedCountries = () => new Promise((res, rej) =>\n\t\td3.json(\"assets/data/artist-countries.json\", (err, data) =>\n\t\t\terr ? rej(err) : res(data)\n\t\t));\n\n\tapi.getCountriesData = (() => {\n\t\tconsole.log(\"Loading countries data...\")\n\t\tlet promise;\n\n\t\treturn () => {\n\t\t\tif (promise) { return promise; }\n\n\t\t\treturn promise = new Promise((res, rej) => {\n\t\t\t\td3.csv(\"assets/data/countries.csv\", function (err, data) {\n\t\t\t\t\tdata.forEach(d => {\n\t\t\t\t\t\td.id = +d.id;\n\t\t\t\t\t\td.names = d.names ? d.names.split(\"|\") : [];\n\t\t\t\t\t\td.tags = d.tags ? d.tags.split(\"|\") : [];\n\t\t\t\t\t\td.mainName = d.names[0];\n\t\t\t\t\t\td.tag = d.tags[0];\n\t\t\t\t\t\td.name = d.mainName;\n\t\t\t\t\t});\n\n\t\t\t\t\tres(data);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t})();\n\t\n\tPromise.all([api.getCountriesData(), getHardcodedCountries()]).then(([countryData, hardcodedCountries]) => {\n\t\tcountryData = countryData.map(d => {\n\t\t\tlet splits = [];\n\n\t\t\tif (d.names.length === 1 && d.tags.length === 0) {\n\t\t\t\tsplits = [d];\n\t\t\t}\n\t\t\tif (d.names.length > 1) {\n\t\t\t\tsplits = splits.concat(d.names.map(name => ({ ...d, name })));\n\t\t\t}\n\t\t\tif (d.tags.length > 0) {\n\t\t\t\tsplits = splits.concat(d.tags.map(tag => ({ ...d, tag }))); \n\t\t\t}\n\n\t\t\tif(d.names.length > 1 &&d.tags.length > 0){ splits.splice(0,1); }\n\t\t\t\n\t\t\treturn splits;\n\t\t}).flat();\n\n\t\tlet alias = d3.nest()\n\t\t\t.key(function(d) {\n\t\t\t\tif (d && d.tag) {\n\t\t\t\t\treturn d.tag.toLowerCase();\n\t\t\t\t} else {\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t})\n\t\t\t.map(countryData);\n\n\t\tlet cname = d3.nest()\n\t\t\t.key(function(d) {\n\t\t\t\treturn d.name.toLowerCase();\n\t\t\t})\n\t\t\t.map(countryData);\n\n\t\t/**\n\t\t * Tries to find out the country for a specified artist.\n\t\t * @param  {String}   artist   Name of the artist to get country for\n\t\t * @param  {Function} callback Callback function, called when the search is over (whether a country's been found or not)\n\t\t *                             The callback function takes one argument, this object:\n\t\t *\n\t\t * \t\t\t\t\t\t\t\t```\n\t\t *                             {\n\t\t *                             \t\"artist\": \"\", // <artist name>,\n\t\t *                             \t\"country\": \"\", // <country name>,\n\t\t *                             \t\"id\": \"\", // <country id>,\n\t\t *                             \t\"tag\": \"\", // <the tag that decided the country (e.g. Swedish for Sweden)>\n\t\t *                             }\n\t\t * \t\t\t\t\t\t\t\t```\n\t\t *\n\t\t * \t\t\t\t\t\t\t\tIf no country could be found, \"country\", \"tag\" and \"id\" are undefined.\n\t\t *\n\t\t */\n\t\tapi.getCountry = function(artist, callback) {\n\t\t\tif (hardcodedCountries[artist]) {\n\t\t\t\tlet hardcodedTagName = hardcodedCountries[artist].toLowerCase();\n\t\t\t\t\n\t\t\t\tconsole.log(`Using hardcoded country tag \"${hardcodedTagName}\" for artist \"${artist}\"`)\n\t\t\t\t\n\t\t\t\tcallback({\n\t\t\t\t\tartist,\n\t\t\t\t\ttag: hardcodedTagName,\n\t\t\t\t\tid: cname[hardcodedTagName][0].id,\n\t\t\t\t\tcountry: cname[hardcodedTagName][0].mainName\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\t// Get artists country code here, from last.fm or whatever\n\t\t\tapi.lastfm.send(\"artist.gettoptags\", [[\"artist\", artist]], function(err, responseData2) {\n\t\t\t\t// Return if something failed\n\t\t\t\tif (err || !responseData2.toptags || !responseData2.toptags.tag || !\n\t\t\t\t\tresponseData2.toptags.tag.length) {\n\t\t\t\t\tcallback({\n\t\t\t\t\t\t\"artist\": artist\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Lista med taggar vi vill dubbelkolla\n\t\t\t\tvar troubleCountries = [\"georgia\", \"ireland\"];\n\t\t\t\tvar troubleLanguages = [\"spanish\", \"french\", \"english\", \"portuguese\", \"russian\", \"italian\", \"japanese\", \"korean\", \"indian\", \"swedish\", \"irish\"];\n\t\t\t\tvar theTroubles = [].concat(troubleCountries, troubleLanguages);\n\n\t\t\t\t// check for country-tags in the artist's tags\n\t\t\t\tlet demonymTag = { tag: \"\", id: null, country: \"\", count: 0 };\n\t\t\t\tlet countryTag = demonymTag;\n\n\t\t\t\tresponseData2.toptags.tag.some(function (t, i) {\n\t\t\t\t\tvar tname = t.name.toLowerCase();\n\n\t\t\t\t\t// no need to search anymore since we only care\n\t\t\t\t\t// about the crme de la creme i.e. the tag with the\n\t\t\t\t\t// highest count\n\t\t\t\t\tif (countryTag.id && demonymTag.id) { return true; }\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// sweden->sweden\n\t\t\t\t\t\tif (!countryTag.id && cname[tname] && cname[tname][0].id) {\n\t\t\t\t\t\t\tcountryTag = { tag: tname, id: cname[tname][0].id, country: cname[tname][0].mainName, count: t.count };\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// swedish -> sweden\n\t\t\t\t\t\tif (!demonymTag.id && alias[tname] && alias[tname][0].id) {\n\t\t\t\t\t\t\tdemonymTag = { tag: tname, id: alias[tname][0].id, country: alias[tname][0].name, count: t.count };\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t});\n\n\t\t\t\t// country is best, demonym second\n\t\t\t\tvar bestTag = (countryTag.id && demonymTag.count < 8 * countryTag.count) ?\n\t\t\t\t\tcountryTag :\n\t\t\t\t\t(demonymTag.id \n\t\t\t\t\t\t? demonymTag\n\t\t\t\t\t\t: {});\n\n\t\t\t\tif (countryTag.tag === \"georgia\" && responseData2.toptags.tag.some(function (t) {\n\t\t\t\t\t\treturn [\"american\", \"us\", \"usa\"].includes(t.name.toLowerCase())\n\t\t\t\t\t})) {\n\t\t\t\t\t// it's not the country...\n\t\t\t\t\tbestTag = demonymTag;\n\n\t\t\t\t\tconsole.info(\"'\" + artist + \"' is tagged with 'georgia', but I'm gonna go ahead and guess they're really from the U.S.\");\n\t\t\t\t}\n\n\t\t\t\tif (theTroubles.includes(bestTag.tag)) {\n\t\t\t\t\tconsole.info(\"Potentially incorrect country for '\" + artist + \"': \" + bestTag.country + \", using the tag '\" + bestTag.tag + \"'\");\n\t\t\t\t}\n\n\t\t\t\tcallback(Object.assign({ \"artist\": artist, }, bestTag));\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Returns a list of country objects for a list of artist names.\n\t\t *\n\t\t * Beware!!! overwrites localstorage.artists when done!!! woaps!!!!!! dododod!!!\n\t\t * @param  {Array}   artists  Array of artist names (String)\n\t\t * @param  {Function} callback Callback function. Argument is a list of country objects,\n\t\t *                             containing only those artists that have a country\n\t\t *                             associated with them. For object structure, see api.getCountry\n\t\t */\n\t\tapi.getCountries = function(artists, callback) {\n\t\t\tvar returnList = [],\n\t\t\t\tcount = 0;\n\t\t\t/**\n\t\t\t * Increases a count and checks if we've tried\n\t\t\t * to get country for all artists\n\t\t\t */\n\t\t\tvar checkCount = function() {\n\t\t\t\tcount++;\n\t\t\t\tsuperCount++;\n\t\t\t\tscript.setLoadingStatus(`Loading artists, please wait... (${superCount} / ${SESSION.total_artists})`);\n\t\t\t\td3.select(\"#loading-text\").html(\"Loading artists...<br>(\" + superCount + \"/\" + SESSION.total_artists + \")<br>You can start exploring,<br>but it might interfere<br>with loading your artists.\");\n\t\t\t\tif (count === artists.length) {\n\t\t\t\t\t// We done, save artists and call back\n\t\t\t\t\tlocalforage.setItem(\"artists\", STORED_ARTISTS, function (err) {\n\t\t\t\t\t\tif (err) { console.error(\"Failed saving artists to storage: \", err); }\n\t\t\t\t\t\tcallback(returnList);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get countries for all artists\n\t\t\tartists.forEach(function(el, i) {\n\t\t\t\t// first check stored artists to see if we've already checked this artist\n\t\t\t\tif (STORED_ARTISTS[el] && STORED_ARTISTS[el].country) {\n\t\t\t\t\tvar returnObject = STORED_ARTISTS[el].country;\n\t\t\t\t\treturnObject.artist = el;\n\t\t\t\t\treturnList.push(returnObject);\n\t\t\t\t\tcheckCount();\n\t\t\t\t} else {\n\t\t\t\t\tvar start = new Date().getTime();\n\n\t\t\t\t\tapi.getCountry(el, function(data) {\n\t\t\t\t\t\tSTORED_ARTISTS[el] = STORED_ARTISTS[el] || {};\n\t\t\t\t\t\t// console.error(data)\n\n\t\t\t\t\t\t// if (data.name) {\n\t\t\t\t\t\tSTORED_ARTISTS[el].country = {\n\t\t\t\t\t\t\t\"id\": data.id,\n\t\t\t\t\t\t\t\"name\": data.name,\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturnList.push(data);\n\t\t\t\t\t\t// }\n\t\t\t\t\t\t// console.log(\"apicall \" + (new Date().getTime() - start) + \" ms\");\n\n\t\t\t\t\t\t// Update loading div, whoah ugly code yeah whaddayagonnado\n\n\n\t\t\t\t\t\tcheckCount();\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t})\n\t\t}\n\t})\n\n\t/**\n\t * Get all tags for an artist.\n\t * @param  {String}   artist   Artist name\n\t * @param  {Function} callback Callback function. Takes one argument which is an array\n\t *                             of tag objects (see the last.fm api doc for tag object structure)\n\t */\n\tapi.getTags = function(artist, callback) {\n\t\t// Check if artist tags are already saved, if so return them\n\t\tif (STORED_ARTISTS[artist] && STORED_ARTISTS[artist].tags) {\n\t\t\t// console.log(\"Had in store, no api call\");\n\t\t\tcallback(STORED_ARTISTS[artist].tags);\n\t\t} else {\n\t\t\t// Create object in localstorage\n\t\t\tSTORED_ARTISTS[artist] = STORED_ARTISTS[artist] || {};\n\t\t\tSTORED_ARTISTS[artist].tags = [];\n\n\t\t\t// Get from lastfm\n\t\t\tapi.lastfm.send(\"artist.gettoptags\", [[\"artist\", artist]],\n\t\t\t\tfunction(err, responseData2) {\n\t\t\t\t\tSTORED_ARTISTS[artist].tags = responseData2.toptags.tag;\n\t\t\t\t\tlocalforage.setItem(\"artists\", STORED_ARTISTS, function (err) {\n\t\t\t\t\t\tif (err) { console.error(\"Failed saving artists to storage: \", err); }\n\t\t\t\t\t\tcallback(STORED_ARTISTS[artist].tags);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t}\n\t}\n\n\tapi.getArtistInfo = function(artist, callback) {\n\t\tvar artistInfo = [];\n\n\t\tapi.lastfm.send(\"artist.getinfo\", [[\"artist\", artist]], function(err, data1) {\n\t\t\t//Creating a list of tag names\n\t\t\tvar tagnamelist = [];\n\t\t\tif (data1.artist.tags.tag) {\n\t\t\t\tdata1.artist.tags.tag.forEach(function(t, i) {\n\t\t\t\t\ttagnamelist.push(t.name);\n\t\t\t\t})\n\t\t\t}\n\n\t\t\tartistInfo.push({\n\t\t\t\tname: artist,\n\t\t\t\turl: data1.artist.url,\n\t\t\t\timage: data1.artist.image[3][\"#text\"],\n\t\t\t\tdescription: data1.artist.bio.summary,\n\t\t\t\ttags: tagnamelist\n\t\t\t})\n\t\t\tcallback(artistInfo);\n\t\t})\n\n\n\n\t}\n\n\t/**\n\t * Gets a list of artists with tags similar to the user's top tags, sorted in descending order.\n\t * Also included are which tags matched.\n\t *\n\t * Calling this function cancels previous requests initiated by this function.\n\t * @param  {String}   country  Name of country or country alias (sweden, swedish, your choice)\n\t * @param  {Function} callback Callback function. Argument is a list of artists.\n\t */\n\tvar recommendationRequests = [];\n\tapi.cancelRecommendationRequests = function () {\n\t\trecommendationRequests.forEach(function (xhr) {\n\t\t\txhr.abort();\n\t\t});\n\n\t\trecommendationRequests = [];\n\t}\n\tapi.getRecommendations = function (country, callback) {\n\t\tapi.cancelRecommendationRequests();\n\n\t\tvar recommendations = [];\n\n\t\t// get top tags for user\n\t\tvar toptags = USER_TAGS.slice(0, 15);\n\t\t// make tag list to an object (back n forthss)\n\t\tvar userTagObj = d3.nest().key(function(d) {\n\t\t\treturn d.tag;\n\t\t}).rollup(function(d) {\n\t\t\treturn d[0].count;\n\t\t}).map(toptags);\n\n\n\t\t//console.log(\"Got top tags for user!\")\n\n\t\t// Get top artists for tag country\n\t\tvar xhr1 = api.lastfm.send(\"tag.gettopartists\", [[\"tag\", country], [\"limit\", 100]], function(err, data1) {\n\t\t\t// Gotta count matching tags to then sort\n\t\t\tvar tagCounts = {};\n\n\t\t\t// Get the tags for these artists\n\t\t\t//console.log(data1, err)\n\t\t\tif (err || data1.error || !data1.topartists || !data1.topartists.artist) {\n\t\t\t\tcallback([]);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar artists = data1.topartists.artist;\n\n\t\t\tartists.forEach(function(a, num) {\n\t\t\t\ttagCounts[a.name] = [];\n\t\t\t\tvar xhr2 = api.lastfm.send(\"artist.gettoptags\", [[\"artist\", a.name]], function(err, data2) {\n\t\t\t\t\tvar hasTags = !data2.error && (data2.toptags.tag ? true : false);\n\t\t\t\t\td3.select(\"#rec-loading-current\").html(\"(\" + a.name + \")\");\n\t\t\t\t\tif (hasTags) {\n\t\t\t\t\t\t// Compare top 10 tags to user tags\n\t\t\t\t\t\tvar tags = d3.nest().key(function(d) {\n\t\t\t\t\t\t\treturn d.name;\n\t\t\t\t\t\t}).map(data2.toptags.tag);\n\n\t\t\t\t\t\t// Get rid of justin bieber\n\t\t\t\t\t\tif (tags[country]) {\n\t\t\t\t\t\t\tfor (var i = data2.toptags.tag.length - 1; i >= 0; i--) {\n\t\t\t\t\t\t\t\tif (userTagObj[data2.toptags.tag[i].name] && data2.toptags.tag[i].count > 5) {\n\t\t\t\t\t\t\t\t\ttagCounts[a.name].push(data2.toptags.tag[i].name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (num === artists.length - 1) {\n\t\t\t\t\t\t//console.log(\"We've gotten tag counts for all artists, make a list!\")\n\t\t\t\t\t\td3.keys(tagCounts).forEach(function(d) {\n\t\t\t\t\t\t\trecommendations.push({\n\t\t\t\t\t\t\t\tname: d,\n\t\t\t\t\t\t\t\tcount: tagCounts[d].length,\n\t\t\t\t\t\t\t\ttags: tagCounts[d]\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\trecommendations.sort(function(a, b) {\n\t\t\t\t\t\t\treturn b.count < a.count ? -1 : b.count > a.count ? 1 : 0;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t//console.log(recommendations)\n\t\t\t\t\t\tcallback(recommendations);\n\t\t\t\t\t}\n\n\t\t\t\t})\n\n\t\t\t\trecommendationRequests.push(xhr2);\n\t\t\t})\n\t\t})\n\n\t\trecommendationRequests.push(xhr1);\n\t}\n\n\tapi.getFriends = function(callback) {\n\t\tapi.lastfm.send(\"user.getFriends\", [[\"user\", SESSION.name]], callback);\n\t}\n\n})(window, document);\n","const utils = utils || {};\n\n(function () {\n  utils.exportToCSV = function (countryCountObj) {\n    const list = map.countryNames.map((country) => {\n      const countryCount = countryCountObj[country.id];\n      return {\n        countryId: country.id,\n        countryName: country.mainName,\n        artists: (countryCount && countryCount[SESSION.name]) || [],\n      };\n    });\n\n    let csv = json2csv.parse(\n      list.sort(({ countryName: a }, { countryName: b }) =>\n        a.localeCompare(b, \"en\")\n      ),\n      {\n        fields: [\n          { label: \"Country\", value: \"countryName\" },\n          { label: \"Number of artists\", value: (row) => row.artists.length },\n          {\n            label: \"Scrobbles\",\n            value: (row) =>\n              row.artists.reduce((acc, artist) => acc + artist.playcount, 0),\n          },\n        ],\n      }\n    );\n\n    csv = \"data:text/csv;charset=utf-8,\" + csv.replaceAll(`\"`, \"\");\n\n    window.open(encodeURI(csv));\n  };\n\n  utils.getCountryNameFromId = function (countryId) {\n    const match = map.countryNames.find((country) => country.id === countryId);\n    if (match && match.mainName) {\n      return match.mainName;\n    }\n    else return \"\"\n  }\n\n  utils.getNumberOfArtistsForCountry = function (countryId) {\n    // Get the current data\n    let data = script.getCurrentData();\n\n    // Flatten and prepare the data\n    let artists = [].concat(...Object.values(data));\n    artists = artists.reduce((acc, item) => {\n        for (let key in item) {\n            if (item.hasOwnProperty(key)) {\n                acc = acc.concat(item[key]);\n            }\n        }\n        return acc;\n    }, [])\n    const artistList = artists.filter(artist => artist.id === countryId)\n    return artists.filter(artist => artist.id === countryId).length\n  }\n})();\n","var screenshot = {};\n\n(function (window, document) {\n\tscreenshot.render = function (autoDownload = false) {\n\t\tvar titleString,\n\t\t\tsubtitleString = \"Make your own at explr.fm\",\n\t\t\timg;\n\n\t\tvar explrLogo = new Image();\n\n\t\tvar svg = d3.select(\"#map-svg\");\n\t\tvar w = svg.attr(\"width\");\n\t\tvar h = svg.attr(\"height\");\n\n\t\tvar canvas = document.createElement(\"canvas\");\n\t\tvar ctx = canvas.getContext(\"2d\");\n\n\t\t// canvg(canvas, document.getElementById(\"map-svg\").outerHTML);\n\n\t\tvar backgroundColor = window.getComputedStyle(document.body).backgroundColor;\n\t\tvar textColor = window.getComputedStyle(document.body).color;\n\n\t\tvar drawCenteredText = function (obj) {\n\t\t\tctx.font = obj.font;\n\t\t\tctx.fillText(obj.string, w / 2 - ctx.measureText(obj.string).width / 2, obj.y);\n\n\t\t\tif (obj.lineWidth) {\n\t\t\t\tctx.lineWidth = obj.lineWidth;\n\t\t\t\tctx.strokeStyle = obj.strokeStyle;\n\t\t\t\tctx.strokeText(obj.string, w / 2 - ctx.measureText(obj.string).width / 2, obj.y);\n\t\t\t}\n\t\t}\n\n\t\tcanvas.width = w;\n\t\tcanvas.height = h;\n\n\t\t// insert background rect\n\t\tsvg.insert(\"rect\", \"g\")\n\t\t\t.attr({\n\t\t\t\tid: \"background-rect\",\n\t\t\t\twidth: \"100%\",\n\t\t\t\theight: \"100%\",\n\n\t\t\t})\n\t\t\t.style({\n\t\t\t\tfill: backgroundColor,\n\t\t\t});\n\n\t\t// Add color, font to legend text\n\t\td3.selectAll('.legend text, text.legend').style({\n\t\t\t\"font-family\": function () {\n\t\t\t\treturn window.getComputedStyle(this)[\"fontFamily\"];\n\t\t\t},\n\t\t\t\"font-size\": function () {\n\t\t\t\treturn window.getComputedStyle(this)[\"fontSize\"];\n\t\t\t},\n\t\t\t\"fill\": textColor,\n\t\t});\n\t\td3.selectAll(\".legend rect\").style({\n\t\t\tstroke: backgroundColor,\n\t\t})\n\n\t\tcanvg(canvas, new XMLSerializer().serializeToString(svg[0][0]));\n\n\t\texplrLogo.onload = function () {\n\t\t\t/* Add text and shiiet */\n\t\t\t// Add text background box\n\t\t\tctx.save(); // To draw with different opaticy\n\t\t\tctx.globalAlpha = 0.6;\n\t\t\tctx.fillStyle = backgroundColor;\n\t\t\tlet scoreString = SESSION.total_artists + \" artists from \" + countryScore + \" / 210 countries\";\n\t\t\tlet titleString = SESSION.name + \"'s musical world map\";\n\t\t\tctx.font = \"34px Patua One\";\n\t\t\tctx.fillRect(w / 2 - ctx.measureText(titleString).width / 2 - 20, h - 110, ctx.measureText(titleString).width + 40, 100);\n\t\t\tctx.fillStyle = textColor;\n\n\t\t\t// Add text\n\t\t\tctx.fillStyle = textColor;\n\t\t\tdrawCenteredText({\n\t\t\t\tstring: titleString,\n\t\t\t\tfont: \"34px Patua One\",\n\t\t\t\ty: h - 60,\n\t\t\t});\n\t\t\tdrawCenteredText({\n\t\t\t\tstring: scoreString,\n\t\t\t\tfont: \"20px Didact Gothic\",\n\t\t\t\ty: h - 40,\n\t\t\t});\n\n\t\t\t// Add explr.fm logo\n\t\t\tctx.restore();\n\t\t\tctx.drawImage(explrLogo, w - 130, h - 60, 100, 36);\n\n\t\t\td3.select(\"#background-rect\").remove();\n\n\t\t\t//console.log(canvas.toDataURL())\n\t\t\t// img = document.createElement(\"img\").src = canvas.toDataURL();\n\t\t\tdocument.getElementById(\"screenshot-img\").src = canvas.toDataURL(\"image/png\");\n\t\t\t// d3.select(\"body\").append(img);\n\t\t\t//\n\n\t\t\tvar dataurl = canvas.toDataURL(\"image/png\");\n\t\t\t// console.log(\"dataurl:\", dataurl)\n\n\t\t\t// window.open(dataurl, \"_blank\");\n\n\t\t\tconst overlay = document.getElementsByClassName(\"screenshot-overlay\")[0];\n\t\t\toverlay.style = \"\";\n\t\t\toverlay.ariaModal = true\n\n\n\t\t\tif (autoDownload) {\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tscreenshot.download();\n\t\t\t\t\tscreenshot.close();\n\t\t\t\t}, 0);\n\t\t\t}\n\n\t\t}\n\t\texplrLogo.src = \"assets/img/explrlogo.png\";\n\t}\n\n\tscreenshot.close = function () {\n\t\tdocument.getElementsByClassName(\"screenshot-overlay\")[0].style = \"display:none;\";\n\t\tdocument.getElementsByClassName(\"screenshot-overlay\")[0].ariaModal = false;\n\t}\n\n\tscreenshot.download = function () {\n\t\tvar dataurl = document.getElementById(\"screenshot-img\").src;\n\t\n\t\t// Create a new anchor element\n\t\tvar a = document.createElement('a');\n\t\n\t\t// Set the href and download attributes of the anchor\n\t\ta.href = dataurl;\n\t\ta.download = 'screenshot.png'; // or any other filename you want\n\t\n\t\t// Append the anchor to the body (this is necessary for Firefox)\n\t\tdocument.body.appendChild(a);\n\t\n\t\t// Programmatically click the anchor\n\t\ta.click();\n\t\n\t\t// Remove the anchor from the body\n\t\tdocument.body.removeChild(a);\n\t}\n\n})(window, document);\n","/* requires:\naria-announcer.js\nsearch.js\n*/\n\nconst keyboardMode = keyboardMode || {};\n\nconst MIN_ZOOM_LEVEL_FOR_KEYBOARD_MODE = 7;\nconst MAX_COUNTRY_SUGGESTIONS = 20;\nlet KEYBOARD_MODE_ACTIVE = false;\nconst ALPHABET = 'ABCDEFGIJKMNOPQRSTUVWXYZ'.split('');\n\nlet visibleCountries = [];\nlet keyBuffer = '';\nlet keyBufferTimer = null;\nlet keyboardModeActive = false;\nlet isKeyboardModeEnabled = false;\nlet currentFocus = null;\n\n// Add a list of country IDs to exclude from keyboard mode\nconst EXCLUDED_COUNTRY_IDS = [\n  831, // Jersey\n  832, // Guernsey\n  833, // Isle of Man\n  136, // Cayman Islands\n  796, // Turks and Caicos Islands\n];\n\nconst handleLetterKeyPress = (e) => {\n\n    // Check if user has pressed a letter key from A to Z\n    if (e.key.match(/[a-zA-Z]/) && e.target.tagName !== \"INPUT\") {\n\n        // Check if it's a single key press with no modifier keys\n        if (e.ctrlKey || e.altKey || e.shiftKey || e.metaKey) {\n            return;\n        }\n        // Convert the key to uppercase\n        const key = e.key.toUpperCase();\n\n        // Convert the key to an index based on the custom alphabet\n        const index = ALPHABET.indexOf(key);\n\n        // Check if the index is within the range of visible countries\n        if (index >= 0 && index < visibleCountries.length) {\n            // Get the country with the corresponding index\n            var targetCountry = visibleCountries[index];\n\n            // Generate a click on the target country\n            if (targetCountry) {\n                targetCountry.dispatchEvent(new Event('click'));\n                // Focus the country name\n                setTimeout(() => {\n                    document.querySelector('#cnameCont h1').setAttribute(\"tabindex\", \"-1\");\n                    document.querySelector('#cnameCont h1').focus();\n                }, 250);\n\n                ga('send', {\n                    hitType: 'event',\n                    eventCategory: 'Keyboard',\n                    eventAction: 'Opened country',\n                    eventLabel: 'test'\n                });\n            }\n        }\n    }\n}\n\nfunction getCurrentlyVisibleCountries() {\n    const userName = window.location.href.split(\"username=\")[1];\n    let data = script.getCurrentData();\n    // return an array consisting of objects with the country name in plain text + the index number of the country\n    let formattedCountries = [];\n    \n    // Add null checks and error handling\n    if (!data || !userName) {\n        console.warn('Data or username not available');\n        return formattedCountries;\n    }\n\n    visibleCountries.forEach((country) => {\n        const countryId = parseInt(country.id.slice(1));\n        \n        // Skip excluded country IDs\n        if (EXCLUDED_COUNTRY_IDS.includes(countryId)) {\n            return;\n        }\n        \n        const letter = ALPHABET[visibleCountries.indexOf(country)];\n        \n        // Add null checks for data[countryId] and data[countryId][userName]\n        const artistCount = data[countryId] && data[countryId][userName] ? \n            data[countryId][userName].length : 0;\n            \n        // Only add countries that have a valid name\n        const countryName = utils.getCountryNameFromId(countryId);\n        if (countryName && countryName !== \"undefined\") {\n            formattedCountries.push({\n                name: countryName,\n                number: letter,\n                artistCount: artistCount,\n                id: countryId\n            });\n        }\n    });\n    return formattedCountries;\n}\n\nfunction isInViewport(element) {\n    // Get country ID from the element\n    const countryId = parseInt(element.id.slice(1));\n    \n    // Skip excluded country IDs\n    if (EXCLUDED_COUNTRY_IDS.includes(countryId)) {\n        return false;\n    }\n    \n    // Check if we have an override for this country in map.COUNTRY_BBOX_OVERRIDES\n    if (map.COUNTRY_BBOX_OVERRIDES && map.COUNTRY_BBOX_OVERRIDES[countryId]) {\n        // For countries with multiple boxes (like USA), check if any box is visible\n        const overrides = map.COUNTRY_BBOX_OVERRIDES[countryId];\n        const boxArray = Array.isArray(overrides[0]) ? overrides : [overrides];\n        \n        return boxArray.some(bbox => isBBoxInViewport(bbox));\n    }\n    \n    // Fall back to the current implementation for countries without overrides\n    const rect = element.getBoundingClientRect();\n\n    // Define the dimensions of the rectangle\n    const rectangleWidth = 400;\n    const rectangleHeight = 400;\n\n    // Calculate the position of the rectangle\n    const rectangleLeft = (window.innerWidth - rectangleWidth) / 2;\n    const rectangleRight = rectangleLeft + rectangleWidth;\n    const rectangleTop = (window.innerHeight - rectangleHeight) / 2;\n    const rectangleBottom = rectangleTop + rectangleHeight;\n\n    // Check if the element is partially within the rectangle\n    return (\n        rect.top <= rectangleBottom &&\n        rect.bottom >= rectangleTop &&\n        rect.left <= rectangleRight &&\n        rect.right >= rectangleLeft\n    );\n}\n\n// New helper function to check if a geographic bounding box is in the viewport\nfunction isBBoxInViewport(bbox) {\n    // Convert geographic coordinates to screen coordinates\n    const [west, south, east, north] = bbox;\n    \n    // Create points for the corners of the bounding box\n    const corners = [\n        [west, north], // Northwest\n        [east, north], // Northeast\n        [east, south], // Southeast\n        [west, south]  // Southwest\n    ];\n    \n    // Project each corner to screen coordinates\n    const screenCorners = corners.map(coord => {\n        const projected = map.projection(coord);\n        return {\n            x: projected[0],\n            y: projected[1]\n        };\n    });\n    \n    // Find the bounding box of the projected corners\n    const minX = Math.min(...screenCorners.map(p => p.x));\n    const maxX = Math.max(...screenCorners.map(p => p.x));\n    const minY = Math.min(...screenCorners.map(p => p.y));\n    const maxY = Math.max(...screenCorners.map(p => p.y));\n    \n    // Get the current transform from the zoom behavior\n    const zoom = d3.select(\"#map-svg\").call(map.zoom);\n    const scale = map.zoom.scale();\n    const translate = map.zoom.translate();\n    \n    // Apply the transform to the bounding box\n    const transformedMinX = translate[0] + minX * scale;\n    const transformedMaxX = translate[0] + maxX * scale;\n    const transformedMinY = translate[1] + minY * scale;\n    const transformedMaxY = translate[1] + maxY * scale;\n    \n    // Define the dimensions of the viewport rectangle\n    const rectangleWidth = 400;\n    const rectangleHeight = 400;\n    \n    // Calculate the position of the rectangle\n    const rectangleLeft = (window.innerWidth - rectangleWidth) / 2;\n    const rectangleRight = rectangleLeft + rectangleWidth;\n    const rectangleTop = (window.innerHeight - rectangleHeight) / 2;\n    const rectangleBottom = rectangleTop + rectangleHeight;\n    \n    // Check if the transformed bounding box intersects with the viewport rectangle\n    return !(\n        transformedMaxX < rectangleLeft ||\n        transformedMinX > rectangleRight ||\n        transformedMaxY < rectangleTop ||\n        transformedMinY > rectangleBottom\n    );\n}\n\nfunction displayKeyboardModeMessage() {\n    const message = document.getElementById(\"keyboard-mode-message\");\n    message.classList.remove(\"hidden\");\n    const innerMessage = document.createElement(\"div\");\n    innerMessage.innerHTML = \"<h2>Keyboard mode active! <span class='fa fa-keyboard'></span> </h2><p>Type a <kbd>letter</kbd> to select a country.<p><p>Move around with <kbd>&#8592;</kbd><kbd>&#8594;</kbd><kbd>&#8593;</kbd><kbd>&#8595;</kbd> keys.</p><p>Exit by zooming out with <kbd>-</kbd> key. </p>\";\n    message.appendChild(innerMessage);\n  }\n\n    function hideKeyboardModeMessage() {\n        const message = document.getElementById(\"keyboard-mode-message\");\n        message.classList.add(\"hidden\");\n        message.innerHTML = \"\";\n    }\n\nfunction getPathCenter(path) {\n    const y = parseFloat(path.getAttribute(\"data-center-y\"));\n    const x = parseFloat(path.getAttribute(\"data-center-x\"));\n    return {\n        x: -x,\n        y: -y\n    };\n    \n  }\n\nlet hasAnnounced = false;\n\nfunction getVisibleCountries() {\n    // Get all country elements in a D3 v3 compatible way\n    const countriesSelection = d3.selectAll(\".country\");\n    const countries = [];\n    \n    // Convert D3 selection to array in v3 compatible way\n    countriesSelection.each(function() {\n        countries.push(this);\n    });\n    \n    // Filter out countries that should be excluded\n    const filteredCountries = countries.filter(country => {\n        const countryId = parseInt(country.id.slice(1));\n        \n        // Skip excluded country IDs\n        if (EXCLUDED_COUNTRY_IDS.includes(countryId)) {\n            return false;\n        }\n        \n        // Skip countries with undefined names\n        const countryName = utils.getCountryNameFromId(countryId);\n        if (!countryName || countryName === \"undefined\") {\n            return false;\n        }\n        \n        // Check if the country is in the viewport\n        return isInViewport(country);\n    });\n    \n    return filteredCountries;\n}\n\nfunction updateVisibleCountries(zoom) {\n    keyboardMode.cleanup();\n    \n    // Get filtered visible countries\n    visibleCountries = getVisibleCountries();\n    \n    if (zoom && zoom.scale() >= MIN_ZOOM_LEVEL_FOR_KEYBOARD_MODE) {\n        // Lets start keyboard mode\n        KEYBOARD_MODE_ACTIVE = true;\n        displayKeyboardModeMessage();\n        \n        // TODO: Find a working way to only announce this once\n        if (!hasAnnounced) {\n            announcer.announce(\"Keyboard mode active! Press L to hear the list of countries.\")\n            hasAnnounced = true;\n        }\n        \n        // Hide controls, footer and legend\n        document.getElementById(\"controls\").classList.add(\"hidden\");\n        document.getElementById(\"legend\").classList.add(\"hidden\");\n        document.getElementById(\"filter-text\").classList.add(\"hidden\");\n        document.getElementById(\"filter\").classList.add(\"hidden\");\n        document.querySelector(\".no-countries\").classList.add(\"hidden\");\n        document.getElementById(\"friends\").classList.add(\"hidden\");\n        \n        // display a number on the center of each country\n        visibleCountries.forEach((country) => {\n            window.addEventListener('keydown', handleLetterKeyPress);\n            \n            var center = getPathCenter(country);\n            const letter = ALPHABET[visibleCountries.indexOf(country)];\n            \n            // Append a circle\n            d3.select(country.parentElement).append(\"rect\")\n                .attr(\"class\", \"a11y-number-bg\")\n                .attr(\"x\", center.x - 1.5) // position the rectangle\n                .attr(\"y\", center.y - 1.5) // position the rectangle\n                .attr(\"width\", 3) // width of the rectangle\n                .attr(\"height\", 3) // height of the rectangle\n                .attr(\"rx\", 0.5) // horizontal corner radius\n                .attr(\"ry\", 0.5); // vertical corner radius\n            \n            // Append a text for the number\n            d3.select(country.parentElement).append(\"text\")\n                .attr(\"class\", \"a11y-number\")\n                .attr(\"data-country-id\", country.id)\n                .attr(\"text-anchor\", \"middle\")\n                .attr(\"alignment-baseline\", \"middle\")\n                .attr(\"x\", center.x) // position the text\n                .attr(\"y\", center.y + 0.2) // position the text\n                .text(letter);\n            \n            // Append a text for the country name\n            d3.select(country.parentElement).append(\"text\")\n                .attr(\"class\", \"a11y-country-name\")\n                .attr(\"text-anchor\", \"middle\")\n                .attr(\"alignment-baseline\", \"middle\")\n                .attr(\"font-size\", \"0.1rem\")\n                .attr(\"x\", center.x) // position the text\n                .attr(\"y\", center.y + 4) // position the text below the number\n                .text(utils.getCountryNameFromId(parseInt(country.id.slice(1))));\n        });\n    }\n}\n\n(function () {\n\n    keyboardMode.init = function (zoom, move, width, height, MAX_ZOOM) {\n\n        // Set keyboard listeners for zoom and pan\n        window.addEventListener('keydown', function(e) {\n\n            const param = window.location.href.split(\"username=\")[1];\n\n\n            // Exit if the search is active or there is no user yet\n            if (search.getSearchStatus() || !param ) {\n                return;\n            }\n\n            // Get the current translation and scale\n            var t = zoom.translate();\n            var s = zoom.scale();\n\n            // Define the distance for each pan step\n            var panStep = 100;\n\n            // Define the factor for each zoom step\n            var zoomStep = 1.25;\n\n            // Get the center of the screen\n            var center = [width / 2, height / 2];\n\n            \n\n            // Adjust the translation or scale based on the key pressed\n            switch(e.key) {\n\n                case 'Escape':\n                    if (map.centered !== null) {\n                        map.dismissCenteredCountry();\n                        keyboardMode.cleanup();\n                        return\n                    }\n                    // reset the zoom and translation\n                    // Calculate the new scale\n                    var newScale = 1;\n\n                    // Calculate the new translation to keep the center fixed\n                    t[0] = center[0] + (t[0] - center[0]) * newScale / s;\n                    t[1] = center[1] + (t[1] - center[1]) * newScale / s;\n\n                    // Update the scale\n                    s = newScale;\n                    e.preventDefault();\n                    move(t, s, false, true);\n                    keyboardMode.cleanup();\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'Escape key',\n                        eventLabel: 'test'\n                    });\n                    break;\n                    \n                case 'ArrowUp':\n                    t[1] += panStep;\n                    e.preventDefault();\n                    move(t, s, false, true);\n                    getVisibleCountries();\n                    announcer.announce(\"Panning north\", \"assertive\", 100)\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'ArrowUp key',\n                        eventLabel: 'test'\n                    });\n                    break;\n                case 'ArrowDown':\n                    t[1] -= panStep;\n                    e.preventDefault();\n                    move(t, s, false, true);\n                    getVisibleCountries();\n                    announcer.announce(\"Panning south\", \"assertive\", 100)\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'ArrowDown key',\n                        eventLabel: 'test'\n                    });\n                    break;\n                case 'ArrowLeft':\n                    t[0] += panStep;\n                    e.preventDefault();\n                    move(t, s, false, true);\n                    getVisibleCountries();\n                    announcer.announce(\"Panning west\", \"assertive\", 100)\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'ArrowLeft key',\n                        eventLabel: 'test'\n                    });\n                    break;\n                case 'ArrowRight':\n                    t[0] -= panStep;\n                    e.preventDefault();\n                    move(t, s, false, true);\n                    getVisibleCountries();\n                    announcer.announce(\"Panning east\", \"assertive\", 100)\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'ArrowRight key',\n                        eventLabel: 'test'\n                    });\n                    break;\n                case '+':\n                case '-':\n                    // Calculate the new scale\n                    var newScale = e.key === '+' ? s * zoomStep : s / zoomStep;\n\n                    // If the new scale exceeds the maximum scale, clamp\n                    if (newScale > MAX_ZOOM) {\n                    newScale = MAX_ZOOM;\n                    }\n\n                    // Calculate the new translation to keep the center fixed\n                    t[0] = center[0] + (t[0] - center[0]) * newScale / s;\n                    t[1] = center[1] + (t[1] - center[1]) * newScale / s;\n\n                    // Update the scale\n                    s = newScale;\n                    e.preventDefault();\n                    move(t, s, false, true);\n\n                    getVisibleCountries();\n                    announcer.announce(`Zoom ${e.key === '+' ? \"in\" : \"out\"} level ${parseInt(newScale)}`, \"assertive\", 100);\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'Zoom in/out',\n                        eventLabel: 'test'\n                    });\n                    break;\n                case 'h':\n                    // Help for screen reader users. Read out the contents of #a11y-info-text\n                    announcer.announce(document.getElementById(\"a11y-info-text\").textContent, \"polite\");\n                    console.log(document.getElementById(\"a11y-info-text\").textContent);\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'Help',\n                        eventLabel: 'test'\n                    }); \n                    break;\n                case 'l':\n                    if (!KEYBOARD_MODE_ACTIVE) {\n                        announcer.announce(\"Keyboard mode is not active right now. Zoom in to at least level 7 to activate.\", \"assertive\", 100);\n                        ga('send', {\n                            hitType: 'event',\n                            eventCategory: 'Keyboard',\n                            eventAction: 'List countries (premature)',\n                            eventLabel: 'test'\n                        });\n                        return;\n                    }\n                    // announce the list of countries\n                    let message = \"List of countries: \";\n                    const countries = getCurrentlyVisibleCountries();\n                    countries.forEach((country) => {\n                        message += `${country.number}: ${country.name} (${country.artistCount} artists), `;\n                    });\n                    announcer.announce(message, \"assertive\", 100);\n                    console.log(message);\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Keyboard',\n                        eventAction: 'List countries',\n                        eventLabel: 'test'\n                    });\n                    break;\n                default:\n                    return; // Exit if it's not an arrow key or zoom key\n            }\n\n            if (map.centered !== null) {\n                map.dismissCenteredCountry();\n            }\n\n        });\n\n    }\n\n    keyboardMode.cleanup = function () {\n        hideKeyboardModeMessage();\n        KEYBOARD_MODE_ACTIVE = false;\n        d3.selectAll(\".a11y-number\").remove();\n        d3.selectAll(\".a11y-number-bg\").remove();\n        d3.selectAll(\".a11y-country-name\").remove();\n        // restore controls, footer and legend\n        document.getElementById(\"controls\").classList.remove(\"hidden\");\n        document.getElementById(\"friends\").classList.remove(\"hidden\");\n        document.getElementById(\"legend\").classList.remove(\"hidden\");\n        document.getElementById(\"filter-text\").classList.remove(\"hidden\");\n        document.getElementById(\"filter\").classList.remove(\"hidden\");\n        document.querySelector(\".no-countries\").classList.remove(\"hidden\");\n        // remove keyboard listeners\n        window.removeEventListener('keydown', handleLetterKeyPress);        \n    }\n\n    keyboardMode.isActive = KEYBOARD_MODE_ACTIVE;\n\n    keyboardMode.getStatus = function () {\n        return KEYBOARD_MODE_ACTIVE;\n    }\n\n    function enableKeyboardMode() {\n        isKeyboardModeEnabled = true;\n        // Likely adds visual indicators or focus states\n    }\n\n    function disableKeyboardMode() {\n        isKeyboardModeEnabled = false;\n        currentFocus = null;\n        // Removes visual indicators\n    }\n\n    keyboardMode.updateVisibleCountries = function(zoom) {\n        updateVisibleCountries(zoom);\n    };\n\n})();\n","const noCountries = noCountries || {};\n\nvar listOfArtistsWithNoCountry = [];\n\nvar saveToStorage = function (key, object, cb) {\n    localforage.setItem(key, object, cb || function () {});\n}\n\nfunction sortArtists(data, method) {\n    if (method === \"scrobbles\")\n        return data.sort((a, b) => b.playcount - a.playcount);\n    else if (method === \"name\")\n        return data.sort((a, b) => a.artist.localeCompare(b.artist));\n}\n\nvar addArtistsWithNoCountry = function (data) {\n    listOfArtistsWithNoCountry = listOfArtistsWithNoCountry.concat(data);\n    saveToStorage(\"no_countries\", listOfArtistsWithNoCountry);\n\n    function handleCheckboxChange() {\n        let artistName = this.id;\n        let checked = this.checked;\n        let artistsState = JSON.parse(localStorage.getItem('noCountryArtistsProgress')) || {};\n        artistsState[artistName] = { artistName, checked };\n        localStorage.setItem('noCountryArtistsProgress', JSON.stringify(artistsState));\n        // If you just checked and the filter is on, remove the artist from the DOM\n        if (checked && document.querySelector(\"#hide-checked\")?.checked) {\n            this.parentNode.style.display = 'none';\n            let nextCheckbox = this.parentNode.nextElementSibling.querySelector('input');\n            if (nextCheckbox) {\n                nextCheckbox.focus();\n            }\n        }\n        // get the label element for the filter checked checkbox\n        let filterCheckedLabel = document.querySelector(\"label[for='hide-checked']\");\n        // Update the label to include the number of checked artists\n        filterCheckedLabel.innerHTML = `Hide checked artists (${document.querySelectorAll(\"dialog[open] ul li input[type='checkbox']:checked\").length})`;\n        ga('send', {\n            hitType: 'event',\n            eventCategory: 'No countries',\n            eventAction: 'Check artist as done',\n            eventLabel: 'test'\n        });\n    }\n\n    \n\n    function updateNoCountriesList() {\n        let artistsState = JSON.parse(localStorage.getItem('noCountryArtistsProgress')) || {};\n        const sortedData = sortArtists(listOfArtistsWithNoCountry, noCountryArtistSortMethod);\n        var noCountriesListEl = d3.select(\".no-countries__content ul\");\n        noCountriesListEl.html(\"\");\n        sortedData.forEach(function (_art) {\n            let artistState = artistsState[_art.artist] || { artistName: _art.artist, checked: false };\n            let listItem = noCountriesListEl.append(\"li\");\n            listItem.append(\"input\")\n                .attr(\"type\", \"checkbox\")\n                .property(\"checked\", artistState.checked)\n                .attr(\"id\", _art.artist)\n                .on(\"change\", handleCheckboxChange);\n            listItem.append(\"label\")\n                .attr(\"for\", _art.artist)\n                .html('<a href=\"' + _art.url + '\" target=\"blank\" class=\"no-countries__link\">' + _art.artist + '</a><span>' + _art.playcount + ' scrobbles</span>');\n            if (document.querySelector(\"#hide-checked\")?.checked && artistState.checked) {\n                listItem.style(\"display\", \"none\");\n            }\n        })\n        d3.select(\".no-countries__info\").html(listOfArtistsWithNoCountry.length + \" artists without a country:\");\n    }\n\n    // Check if the checkbox and label already exist\n    if (!d3.select(\"#hide-checked\").node() && !d3.select(\"label[for='hide-checked']\").node()) {\n        // Add the checkbox next to the filter radios\n        d3.select(\"dialog fieldset\").append(\"input\")\n            .attr(\"type\", \"checkbox\")\n            .attr(\"id\", \"hide-checked\")\n            .on(\"change\", updateNoCountriesList);\n        d3.select(\"dialog fieldset\").append(\"label\")\n            .attr(\"for\", \"hide-checked\")\n            .text(\"Hide checked artists\");\n    }\n\n    // Handle sorting with radios\n    let radios = document.getElementsByName('sort');\n    function sortFunction() {\n        let selectedValue;\n        for (let radio of radios) {\n            if (radio.checked) {\n                selectedValue = radio.value;\n                noCountryArtistSortMethod = selectedValue;\n                updateNoCountriesList();\n                break;\n            }\n        }\n        ga('send', {\n            hitType: 'event',\n            eventCategory: 'No countries',\n            eventAction: 'Sort artists',\n            eventLabel: 'test'\n        });\n    }\n\n    for (let radio of radios) {\n        radio.addEventListener('change', sortFunction);\n    }\n\n    updateNoCountriesList(\"scrobbles\");\n\n    document.querySelector(\".no-countries__title\").addEventListener(\"click\", function () {\n        const dialog = document.querySelector(\".no-countries__content\");\n        dialog.showModal();\n\n        document.querySelector(\"#no-countries__heading\").focus();\n\n        // Update the label to include the number of checked artists\n        let filterCheckedLabel = document.querySelector(\"label[for='hide-checked']\");\n        filterCheckedLabel.innerHTML = `Hide checked artists (${document.querySelectorAll(\"dialog[open] ul li input[type='checkbox']:checked\").length})`;\n\n        document.addEventListener(\"keydown\", function (e) {\n            if (e.keyCode == 27) {\n                const dialog = document.querySelector(\".no-countries__content\");\n                dialog.close();\n                document.querySelector(\".no-countries__title\").focus();\n            }\n        });\n        ga('send', {\n            hitType: 'event',\n            eventCategory: 'No countries',\n            eventAction: 'Open dialog',\n            eventLabel: 'test'\n        });\n    });\n\n    document.querySelector(\".no-countries__content .close\").addEventListener(\"click\", function () {\n        const dialog = document.querySelector(\".no-countries__content\");\n        dialog.close();\n        document.querySelector(\".no-countries__title\").focus();\n    });\n    const dialog = document.querySelector(\".no-countries__content\");\n    dialog.addEventListener(\"click\", function (event) {\n        if (event.target === dialog) {\n            dialog.close();\n            }\n    });\n\n    if (listOfArtistsWithNoCountry.length) {\n        setTimeout(function () {\n            document.querySelector(\".no-countries\").classList.remove(\"hidden\");\n        }, 850);\n    }\n}\n\nnoCountries.addArtistsWithNoCountry = addArtistsWithNoCountry;","/* requires:\napi/api.js\napi/lastfm.js\nutils.js\nsearch.js\naria-announcer.js\nno-countries.js\nkeyboard-mode.js\n*/\n\nvar script = script || {};\nlet loadingReady = false;\nlet loadingStatus = loadingReady ? \"Ready to Explr!\" : \"Loading...\";\nlet announcementIntervalId;\nlet noCountryArtistSortMethod = \"scrobbles\";\n\n\nvar STORED_ARTISTS;\nvar STORED_ARTISTS_PROMISE = localforage.getItem(\"artists\").then(val => \n    STORED_ARTISTS = val || {}\n);\n\nvar CACHED_NO_COUNTRIES;\nvar CACHED_NO_COUNTRIES_PROMISE = localforage.getItem(\"no_countries\").then(val => \n    CACHED_NO_COUNTRIES = val || {}\n);\n\nvar USER_TAGS = []; // JSON.parse(window.localStorage.user_tags || \"[]\");\nvar CACHED_USERS = JSON.parse(window.localStorage.cached_users || \"{}\");\nvar SESSION = {};\n\n\nfunction clearExplrCache() {\n    var theme = window.localStorage.getItem(\"theme\");\n    window.localStorage.clear();\n    window.localStorage.setItem(\"theme\", theme);\n\n    announcer.announce(\"Cleared artist cache, reloading page...\");\n\n    return localforage.clear();\n}\n\nvar countryCountObj = {};\n\n(function () {\n    // user = prompt(\"Input your user name, get top 20 artists\")\n    var user, currPage = 1,\n        maxPage;\n    var count = 0;\n    var tries = 0;\n    var randomcountrylist = [\"Malawi\", \"Malaysia\", \"Peru\", \"Sierra Leone\", \"Trinidad & Tobago\", \"Greece\", \"Laos\", \"Iran\", \"Haiti\", \"Nicaragua\", \"Mongolia\", \"Slovakia\"];\n\n    var getAllArtists = function () {\n        // console.log(\"get artists\")\n\n        loadingReady = false;\n\n        api.lastfm.send(\"library.getartists\", [\n                [\"user\", user],\n                [\"limit\", 50],\n                [\"page\", currPage]\n            ],\n            function (error, responseData) {\n                // Special case for unfortunate users\n                if (responseData === \"\") {\n                    console.error('Got empty string (\"\") as response, skipping page.')\n                    currPage++;\n                    getAllArtists();\n                    return;\n                }\n                if (error || responseData.error) {\n                    console.error(\"Error in getAllArtists, page \" + currPage, error, responseData);\n\n                    // Try again, but not forever\n                    if (tries++ < 5) {\n                        getAllArtists();\n\n                        // TODO: Show erorr message ;)\n                    } else {\n                        var refresh = confirm(\"Last.fm took too long to respond.\\n\\nPress OK to refresh the page and try again, or Cancel to use the page as it is.\");\n                        if (refresh) {\n                            clearExplrCache().then(function () {\n                                saveToStorage(\"artists\", STORED_ARTISTS, function () {\n                                    window.location.reload()\n                                });\n                            })\n                        }\n                    }\n                    return;\n                }\n\n                tries = 0;\n\n                if (currPage === 1) {\n                    SESSION.total_artists = +responseData.artists[\"@attr\"].total;\n                    maxPage = +responseData.artists[\"@attr\"].totalPages;\n\n                    if (SESSION.total_artists === 0) {\n                        d3.select(\".bubblingG\").remove();\n                        d3.select(\"#loading-text\")\n                            .html(\"You haven't listened to any<br> artists yet. Start scrobbling with <br>\\\n                                                        <a href='http://evolver.fm/2012/05/08/how-to-scrobble-to-last-fm-from-itunes-\" +\n                                \"spotify-and-more/'>your favorite music player!</a>\");\n                        d3.select(\".loader\").style(\"pointer-events\", \"all\");\n                        return;\n                    }\n                }\n\n                currPage++;\n                // console.log(\"Artists done, get countries\");\n\n                // Save artist data to localStorage (and create a list of artist names)\n                var artistNames = []\n                responseData.artists.artist.forEach(function (newArtist) {\n                    var a = STORED_ARTISTS[newArtist.name] || {};\n\n                    a.playcount = +newArtist.playcount;\n                    a.url = newArtist.url;\n\n                    STORED_ARTISTS[newArtist.name] = a;\n                    artistNames.push(newArtist.name);\n                })\n                saveToStorage(\"artists\", STORED_ARTISTS);\n                // var n = count++;\n\n                // Get country for all artists\n                api.getCountries(artistNames, function (data) {\n                    //Gr s att man kan sl upp p land-id och f upp en lista p artister.\n                    var newArtistCountries = d3.nest().key((d) => d.id)\n                        // gr s att man fr en lista p alla artister fr ett land.\n                        .rollup((leaves) => leaves)\n                        // Skickar in en lista med ett objekt fr varje artist.\n                        .map(data);\n\n                    d3.keys(newArtistCountries).forEach(function (id) {\n                        countryCountObj[id] = countryCountObj[id] || {};\n                        countryCountObj[id][user] = countryCountObj[id][user] || [];\n\n                        var artistsFromCountry = countryCountObj[id][user];\n\n                        artistsFromCountry = artistsFromCountry.concat(newArtistCountries[id]);\n\n                        artistsFromCountry.forEach(function (el, i) {\n                            //Hr lgger vi till ett flt image med artistens bild-url som ett flt till det \"inre\" objektet.\n                            artistsFromCountry[i].url = STORED_ARTISTS[el.artist].url;\n                            artistsFromCountry[i].playcount = STORED_ARTISTS[el.artist].playcount;\n                        });\n                        // countryCountObj r en lista med \"country\"-objekt. \n                        // Varje country-objekt innehller en lista med \"inre\" objekt med artistnamn, lands-id och landsnamn.\n                        // dataObj r typ samma som countryCountObj, fast r bara fr de tillflligt sparade artisterna (intervallet).\n                        countryCountObj[id][user] = artistsFromCountry;\n                    })\n\n                    noCountries.addArtistsWithNoCountry(data.filter((artist) => !artist.id));\n\n                    map.addArtists(newArtistCountries);\n\n                    if (currPage > maxPage) {\n                        end();\n                        return;\n                    } else {\n                        getAllArtists();\n                    }\n                });\n            });\n    }\n\n    var getRecommendations = function () {\n        var currPage = 1,\n            limit = 50,\n            maxPage = 1000 / limit;\n        var countriesList = JSON.parse(window.localStorage.countries);\n\n        var countriesObj = d3.nest().key(function (d) {\n            return d.name;\n        }).rollup(function (d) {\n            return d[0];\n        }).map(countriesList);\n        // Get \"all\" artists from one country\n        // countriesList.forEach(function(country){\n\n        // });\n        api.lastfm.send(\"tag.gettopartists\", [\n            [\"tag\", \"swedish\"],\n            [\"limit\", limit],\n            [\"page\", currPage]\n        ], function (err, data) {\n            var artists = data.topartists.artist;\n            // For each artist, get their tags\n            artists.forEach(function (a) {\n                api.lastfm.send(\"artist.gettoptags\", [\n                    [\"artist\", a.name]\n                ], function (err, data) {\n                    // console.log(data);\n                })\n            })\n            // Look for user's top tags in artist tags\n            // If a lot of matches, save to recommended artists for that country\n        });\n\n    }\n\n    var getUserTags = function (err, data) {\n        // err = err ||data.error;\n        if (err || data.error) {\n            if (data && data.error === 6) {\n                alert(\"User not found\");\n                window.location.assign(window.location.origin + window.location.pathname);\n            }\n        }\n\n\n        /*if (err || data.error) {\n            console.error(\"Erorr in getUserTags\", err, data);\n            alert(\"Something went wrong when contacting the Last.fm API\\n\\nEither:\\n - The specified user does not exist\\n - Last.fm is down\\n\\nPlease try again.\");\n            window.location.replace(window.location.origin + window.location.pathname);\n        }*/\n\n        var c = 0;\n\n        var tagCount = {};\n\n        //console.log(\"Gotta get tags\")\n\n        var topArtists = data.topartists.artist;\n        var done = function () {\n            // make list of tags to sort\n            USER_TAGS = [];\n            //Remove specific tags from user's top tags\n            let forbidden = [\"american\", \"swedish\", \"british\", \"female vocalists\", \"male vocalists\", \"german\", \"seen live\", \"english\", \"singer-songwriter\", \"spanish\", \"french\"];\n            d3.keys(tagCount).forEach(function (el) {\n                var nogood = false\n                for (let i = 0; i < forbidden.length; i++) {\n                    if (el === forbidden[i]) {\n                        nogood = true;\n                    }\n                }\n                if (!nogood) {\n                    USER_TAGS.push({\n                        tag: el,\n                        count: tagCount[el]\n                    });\n                }\n            })\n            USER_TAGS.sort(function (a, b) {\n                return b.count < a.count ? -1 : b.count > a.count ? 1 : 0;\n            });\n            console.info(\"Done getting tags, saved to localStorage.user_tags\")\n            window.localStorage.user_tags = JSON.stringify(USER_TAGS);\n        }\n\n\n        topArtists.forEach(function (el, i) {\n            // get top ten tags and save to users tag count....\n            setTimeout(function () { // Set timeout to not stop artists from loading...\n                api.lastfm.send(\"artist.gettoptags\", [\n                    [\"artist\", el.name]\n                ], function (err, data) {\n                    let taglist = data.toptags && data.toptags.tag;\n                    if (taglist) {\n                        var lim = Math.min(taglist.length, 10);\n                        for (var i = 0; i < lim; i++) {\n                            if (tagCount[taglist[i].name]) {\n                                tagCount[taglist[i].name]++;\n                            } else {\n                                tagCount[taglist[i].name] = 1;\n                            }\n                        }\n                        // console.log(c, topArtists.length)\n                    }\n\n                    c++;\n                    if (c == topArtists.length - 1) {\n                        done();\n                    }\n                });\n            }, Math.random() * 3000);\n        });\n\n    }\n\n    var begin = function () {\n        //Send analytics event\n        ga('send', 'event', 'splash screen', 'Go!', 'test');\n        document.getElementById(\"map-label\").innerHTML = `${user}'s world map`;\n        // fade out username input box\n        var welcomeOverlay = d3.select(\"#welcome-container\");\n        welcomeOverlay.transition().duration(2000)\n            .style(\"opacity\", 0)\n            .each(\"end\", function () {\n                welcomeOverlay.remove();\n            });\n\n        // Fade in loader\n        d3.select(\".loader\").transition().duration(2000).style(\"opacity\", 1);\n        d3.select(\"#loading-text\").html(\"Getting library...\");\n\n        // Screen reader status update every 30 seconds\n        setTimeout(function () {\n            announcer.announce(document.getElementById(\"loading-text\")?.innerText);\n        }, 6000);\n\n        setTimeout(function () {\n            if (d3.select(\"#loading-text\")?.html() === \"Getting library...\") {\n                d3.select(\"#loading-text\").html(\"Last.fm is taking<br>a long time to<br>respond...\");\n                setTimeout(function () {\n                    if (d3.select(\"#loading-text\").html() === \"Last.fm is taking<br>a long time to<br>respond...\") {\n                        d3.select(\"#loading-text\").html(\"Maybe <a href='http://last.fm' target='_blank'>last.fm</a> has<br>gone offline...\")\n                            .style(\"pointer-events\", \"all\");\n                    }\n                }, 8000);\n            }\n        }, 8000);\n\n        // Show hidden screen reader help text\n        document.getElementById(\"a11y-map-info\").classList.remove(\"hidden\");\n\n        // Fade in legend, progress-bar etc\n        d3.selectAll(\".on-map-view\").style({\n            \"visibility\": \"visible\",\n            //            \"opacity\": 0\n        }) //.transition().duration(1000).style(\"opacity\", 1);\n\n        // Get user tags\n        api.lastfm.send(\"user.gettopartists\", [\n            [\"user\", user],\n            [\"period\", \"12months\"],\n            [\"limit\", \"50\"]\n        ], getUserTags);\n\n        // Get user friends\n        api.getFriends(function (err, data) {\n            try {\n                var friends = data.friends.user;\n                var i = 0;\n                var friendName = d3.select(\"#friend-name\");\n\n                var updateName = function () {\n                    friendName.html(\"\");\n                    friendName.append(\"a\").attr({\n                        href: window.location.origin + window.location.pathname + \"?username=\" + friends[i].name,\n                        target: \"_self\",\n                    }).html(friends[i].name);\n                }\n\n                d3.selectAll(\".arrow\").on(\"click\", function () {\n                    if (d3.select(this).classed(\"left\")) {\n                        // Go left\n                        i = (i === 0 ? friends.length - 1 : i - 1);\n                    } else {\n                        // Go right\n                        i = (i + 1) % friends.length;\n                    }\n\n                    updateName();\n                })\n\n                updateName();\n                d3.select(\"#friends #msg\").html(\"Check out \" + user + \"'s friends\")\n                d3.select(\"#friends\").transition().duration(1000).style(\"opacity\", 1);\n\n            } catch (e) {\n                console.error(\"getFriends()\", e);\n                d3.select(\"#friends\").html(\"&nbsp;Couldn't find any<br>friends on last.fm :(&nbsp;\")\n                d3.select(\"#friends\").transition().duration(1000).style(\"opacity\", 1);\n            }\n        });\n\n        if (CACHED_USERS[user]) {\n            // TODO: use timestamp\n            console.info(\"No new artists on last.fm!\");\n            countryCountObj = JSON.parse(window.localStorage.countryCountObj);\n\n            localforage.getItem(\"no_countries\", function (err, val) {\n                noCountries.addArtistsWithNoCountry(val || []);\n            });\n\n            // Get number of artists for screenshot etc.\n            api.lastfm.send(\"library.getartists\", [\n                    [\"user\", user],\n                    [\"limit\", 1],\n                    [\"page\", 1]\n                ],\n                function (error, responseData) {\n                    SESSION.total_artists = +responseData.artists[\"@attr\"].total;\n                });\n\n            setTimeout(function () {\n                map.addArtists(\n                    Object.keys(countryCountObj).reduce((acc, countryId) => ({\n                        ...acc,\n                        [countryId]: countryCountObj[countryId][SESSION.name]\n                    }), {}));\n                end();\n            }, 1000)\n        } else {\n            // Save theme\n            var theme = window.localStorage.theme;\n            window.localStorage.clear();\n            if (theme) {\n                window.localStorage.theme = theme;\n            }\n            getAllArtists();\n        }\n    }\n\n    var end = function () {\n        loadingReady = true;\n\n        // Screen reader status update\n        clearInterval(announcementIntervalId);\n        announcer.announce(\"All artists have been loaded!\");\n        const map = document.querySelector(\"#map-container svg\")\n        const existingAriaLabelledBy = map.getAttribute(\"aria-labelledby\");\n        map.setAttribute(\"aria-labelledby\", `${existingAriaLabelledBy} progress-text sr-instructions`);\n\n        // We're done, fade out loader\n        var loader = d3.select(\".loader\");\n        loader.transition().duration(2000)\n            .style(\"opacity\", 0)\n            .each(\"end\", function () {\n                loader.remove();\n            });\n        //Also fade out progress bar text (after a short delay)\n        d3.select(\"#progress-text\").transition().delay(5000).duration(1500)\n            .style(\"opacity\", 0);\n\n        CACHED_USERS = {};\n        CACHED_USERS[user] = new Date().getTime();\n        window.localStorage.cached_users = JSON.stringify(CACHED_USERS);\n        window.localStorage.countryCountObj = JSON.stringify(countryCountObj);\n    }\n\n    // // Set theme\n    // map.nextTheme(window.localStorage.theme || \"pink_white\");\n\n    // Try to get username from url\n    var param = window.location.href.split(\"username=\")[1];\n\n    if (param) { // We already have a user\n\n        // Set up search button listener\n        document.addEventListener('DOMContentLoaded', (event) => {\n            document.getElementById('search-button').addEventListener('click', function() {\n                // Set timeout needed to make sure the browser is ready to focus the search box\n                setTimeout(()=> { search.initSearch() }, 0) ;\n            });\n        });\n\n        // set up keyboard shortcuts\n        window.addEventListener(\"keydown\", function (evt) {\n\n            if ((evt.ctrlKey || evt.metaKey) && evt.keyCode === 70 && !evt.shiftKey && !keyboardMode.getStatus()) { \n                console.log(keyboardMode.getStatus());               \n                // Prevent the browser's default \"ctrl + f\" or \"cmd + f\" action (usually \"Find\")\n                evt.preventDefault();\n\n                // Initialize the search box\n                search.initSearch();\n                \n            }\n            // Supress hotkeys if search or keyboard mode is open \n            if (search.getSearchStatus() || keyboardMode.getStatus()) {\n                return;\n            };\n            switch (evt.keyCode) {\n                case 83:\n                    screenshot.render();\n                    //Send google analytics event\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Hotkeys',\n                        eventAction: 'Take screenshot',\n                        eventLabel: 'test'\n                    });\n                    break;\n                    // t\n                case 84:\n                    nextTheme();\n                    //Send google analytics event\n                    ga('send', {\n                        hitType: 'event',\n                        eventCategory: 'Hotkeys',\n                        eventAction: 'Cycle theme',\n                        eventLabel: 'test'\n                    });\n                    break;\n                default:\n                    break;\n            }\n        });\n\n        if (param.length > 15) {\n            param = param.substr(0, 15);\n        }\n        user = param;\n        SESSION.name = param;\n        Promise.all([CACHED_NO_COUNTRIES_PROMISE, STORED_ARTISTS_PROMISE]).then(() => begin());\n    } else {\n        d3.select(\"#welcome-container\").style(\"visibility\", \"visible\");\n        d3.select(\"#randomCountry\").html(randomcountrylist[Math.floor(Math.random() * (randomcountrylist.length))] + \"?\")\n    }\n\n    var saveToStorage = function (key, object, cb) {\n        localforage.setItem(key, object, cb || function () {});\n    }\n\n})();\n\nscript.getCurrentData = function () {\n    if (loadingReady) {\n        return JSON.parse(window.localStorage.getItem('countryCountObj'));;\n    } else {\n        return countryCountObj;\n    }\n\n}\n\nscript.getLoadingStatus = function () {\n    return loadingStatus;\n}\nscript.setLoadingStatus = function (status) {\n    loadingStatus = status;\n}","/* requires:\napi/api.js\napi/lastfm.js\nscript.js\naria-announcer.js\nkeyboard-mode.js\n*/\nvar map = {};\n//White theme default:\nvar colorArray = [\"#feebe2\", \"#feebe2\", \"#fcc5c0\", \"#fa9fb5\", \"#f768a1\", \"#dd3497\", \"#ae017e\", \"#7a0177\"];\nvar legend;\nvar countryScore = 0;\nlet currentPage = 1;\nlet itemsPerPage = 5;\nlet artists = []; // Your artists data goes here\nlet currentZoom = 1;\nconst MAX_ZOOM = 25;\n\nconst prefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\n\n// Update the COUNTRY_BBOX_OVERRIDES constant\nconst COUNTRY_BBOX_OVERRIDES = {\n  // Format: [west, south, east, north]\n  // US territories as multiple boxes\n  '840': [\n    [-125, 24, -66, 50],  // Continental US\n    [-180, 51, -130, 72], // Alaska\n    [-160, 18, -154, 23], // Hawaii\n  ],\n  // Russia - adjusted boundaries\n  '643': [\n    [27.5, 41.0, 180.0, 82.0],   // Main Russian territory (European + Asian)\n    [-180.0, 60.0, -169.0, 71.0], // Far Eastern part (crosses the date line)\n  ],\n  // Chile - mainland only, excluding Pacific islands\n  '152': [\n    [-75.6, -55.9, -66.0, -17.5],  // Chilean mainland\n    [-109.5, -27.2, -109.2, -27.0], // Easter Island (Rapa Nui)\n    [-80.8, -33.8, -80.0, -33.3]    // Juan Fernndez Islands\n  ],\n  // Ecuador - mainland only, excluding Galpagos\n  '218': [\n    [-81.5, -5.0, -75.0, 1.5],   // Ecuadorian mainland\n    [-92.0, -1.4, -89.2, 1.7]     // Galpagos Islands\n  ],\n  // Spain - mainland and islands\n  '724': [\n    [-9.3, 36.0, 3.4, 43.8],     // Iberian Peninsula (mainland Spain)\n    [-18.2, 27.6, -13.3, 29.5],   // Canary Islands\n    [1.2, 38.6, 4.4, 40.1]        // Balearic Islands\n  ],\n  // Portugal\n  '620': [\n    [-9.5, 36.8, -6.2, 42.2],     // Continental Portugal (mainland)\n    [-31.3, 32.6, -16.2, 39.7]     // Atlantic islands (Azores and Madeira)\n  ],\n  // France - mainland and overseas territories\n  '250': [\n    [-5.1, 41.3, 9.6, 51.1],     // Metropolitan France (mainland)\n    [-54.6, 2.1, -51.6, 5.8],     // French Guiana\n    [55.2, -21.4, 55.8, -20.8],   // Runion\n    [-61.2, 14.4, -60.8, 14.9],   // Martinique\n    [-61.8, 15.8, -61.0, 16.5],   // Guadeloupe\n    [8.5, 41.3, 9.6, 43.0]        // Corsica\n  ],\n  // Netherlands - mainland and Caribbean territories\n  '528': [\n    [3.3, 50.7, 7.2, 53.6],      // Mainland Netherlands\n    [-69.2, 12.0, -68.2, 12.4],   // Aruba\n    [-69.0, 11.9, -68.2, 12.4],   // Curaao\n    [-63.2, 17.9, -62.9, 18.1]    // Sint Maarten\n  ],\n  // New Zealand - main islands\n  '554': [\n    [166.0, -47.5, 179.0, -34.0],  // Main islands (North and South)\n    [172.5, -43.9, 173.9, -40.5],  // Chatham Islands\n  ],\n  // Fiji - main island group (corrected)\n  '242': [\n    [177.0, -21.0, 180.0, -16.0],  // Western islands (up to the date line)\n    [-180.0, -21.0, -178.0, -16.0], // Eastern islands (from the date line)\n  ],\n  // Kiribati - three island groups spread across the Pacific\n  '296': [\n    [172.0, -3.0, 177.0, 5.0],      // Gilbert Islands (western group)\n    [-175.0, -11.5, -170.0, -5.0],   // Phoenix Islands (central group)\n    [-160.0, -5.0, -150.0, 12.0],    // Line Islands (eastern group)\n  ],\n  // Add other countries as needed\n};\n\nmap.COUNTRY_BBOX_OVERRIDES = COUNTRY_BBOX_OVERRIDES;\n\n(function(window, document) {\n  d3.select(window).on(\"resize\", throttle);\n\n  var doThrottle = false;\n  var filter = \"artists\"; // filter by artists or plays\n\n  var zoom = d3.behavior.zoom()\n    .scaleExtent([1, MAX_ZOOM])\n    .on(\"zoom\", move);\n\n\n  var height, width;\n\n  var topo, projection, path, svg, g, countryNames, rateById, centered, active;\n  let countryCount = {};\n  let countryDivIsOpen = false;\n  let currentNoArtists = 0;\n  let currentCount = 0;\n  let currentCountry = null;\n\n  //Variables needed to update scale and legend\n  var mydomain = [0, 1, 2, 3, 4, 5, 6];\n  var maxartists = 1,\n    maxplaycount = 0;\n\n  //Setting color and range to be used\n  var color;\n\n\n  // Set theme\n  const defaultTheme = window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"blue_black\" : \"pink_white\";\n  var theme = window.localStorage.theme || defaultTheme;\n\n  map.drawPlays = function() {\n    filter = \"scrobbles\";\n    redraw();\n  };\n\n  let countryPlaylists; \n  // load links to country playlists\n  d3.json(\"assets/data/playlists.json\", (err, list) => {\n    countryPlaylists = list;\n  });  \n\n  /**\n   * Sets width/height, i.e. changes the global variables \"width\" and \"height\"\n   */\n  function updateDimensions() {\n    height = window.innerHeight - 5;\n    width = document.getElementById('map-container').offsetWidth;\n  }\n\n  //Returns total number of plays for country\n  function getCountryPlaycount(c) {\n    if (countryCount[c.id]) {\n      var count = 0;\n      for (let i = 0; i < countryCount[c.id].length; i++) {\n        count += countryCount[c.id][i].playcount;\n      }\n      return count;\n    } else return 0;\n  };\n\n\n  function updateProgressBar() {\n    var progressPro = (countryScore / 210);\n    return progressPro;\n  }\n;\n\n  //Function to format numbers over 1000 with a space\n  function numbersWithSpace(x) {\n    return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \" \");\n  }\n  /**\n   * Randomize array element order in-place.\n   * Using Fisher-Yates shuffle algorithm.\n   */\n  function shuffleArray(array) {\n    for (let i = array.length - 1; i > 0; i--) {\n      var j = Math.floor(Math.random() * (i + 1));\n      var temp = array[i];\n      array[i] = array[j];\n      array[j] = temp;\n    }\n    return array;\n  }\n  //Function to remove duplicates from arrays\n  function onlyUnique(value, index, self) {\n    return self.indexOf(value) === index;\n  }\n\n  function updateScale() {\n    var max = -1;\n    switch (filter) {\n      case \"artists\":\n        max = maxartists;\n        for (let i = 0; i < 5; i++) {\n          mydomain[i] = Math.pow(Math.E, (Math.log(max) / 6) * (i + 1));\n        }\n        mydomain = [0, 1, mydomain[0], mydomain[1], mydomain[2], mydomain[3], mydomain[4]];\n        break;\n      case \"scrobbles\":\n        max = maxplaycount;\n        for (let i = 0; i < 7; i++) {\n          mydomain[i] = Math.pow(Math.E, (Math.log(max) / 7) * (i + 1))\n        }\n        mydomain = [0, 1, mydomain[1], mydomain[2], mydomain[3], mydomain[4], mydomain[5]];\n        break;\n    };\n\n\n    color = d3.scale.threshold()\n      .domain(mydomain)\n      .range(colorArray);\n  };\n\n  function updateLegend() {\n    //Remove decimals from domain\n    var x = 0;\n    var len = mydomain.length\n    while (x < len) {\n      mydomain[x] = Math.ceil(mydomain[x]);\n      x++;\n    };\n\n    //Array of text\n    var legend_labels = [numbersWithSpace(mydomain[0]) + \"\", mydomain[1] + \"-\" + (mydomain[2] - 1), mydomain[2] + \"-\" + (mydomain[3] - 1), mydomain[3] + \"-\" + (mydomain[4] - 1), mydomain[4] + \"-\" + numbersWithSpace((mydomain[5] - 1)), numbersWithSpace(mydomain[5]) + \"-\" + numbersWithSpace((mydomain[6] - 1)), \"> \" + numbersWithSpace(mydomain[6])];\n\n    //Create Legend\n    svg.select(\"g#legend\").selectAll(\"g.legend\").remove(); // need to remove for theme changing :(\n    legend = svg.select(\"g#legend\").selectAll(\"g.legend\")\n      .data(mydomain);\n\n    //Color box sizes\n    var ls_w = 20,\n      ls_h = 20;\n    var x = width * 0.03;\n    var y = height * 0.03;\n\n    // Add legend filter text\n    var text1 = svg.select(\"#filter-text\")\n      .attr(\"x\", x)\n      .attr(\"y\", height - y - mydomain.length * ls_h - 1.5 * ls_h)\n      .text(\"Number of \");\n    var text2 = svg.select(\"#filter\")\n      .attr(\"x\", x + text1[0][0].getComputedTextLength() + 5)\n      .attr(\"y\", height - y - mydomain.length * ls_h - 1.5 * ls_h)\n      .text(filter);\n    text2.on(\"click\", function() {\n      // Toggle filter method\n      filter = (filter === \"artists\" ? \"scrobbles\" : \"artists\");\n      redraw();\n    });\n\n    var noCountryArtists = d3.select(\".no-countries\")\n      .style(\"bottom\", (y + mydomain.length * ls_h + 1.5 * ls_h + 30) + \"px\"); // <<< magic numbers broo\n\n    var enter = legend.enter()\n      .append(\"g\")\n      .attr(\"class\", \"legend\");\n\n    enter.append(\"rect\")\n      .attr(\"x\", x)\n      .attr(\"y\", function(d, i) {\n        return height - (i * ls_h) - 2 * ls_h - y;\n      })\n      .attr(\"width\", ls_w)\n      .attr(\"height\", ls_h)\n      .style(\"fill\", function(d) {\n        return color(d);\n      });\n    enter.append(\"text\")\n      .attr(\"x\", x + 30)\n      .attr(\"y\", function(d, i) {\n        return height - (i * ls_h) - ls_h - 4 - y;\n      });\n\n    legend.selectAll(\"text\").data(mydomain)\n      .text(function(d, _, i) {\n        return legend_labels[i];\n      });\n  }\n  //Variables for color legend\n\n  var tooltip = d3.select(\"#map-container\").append(\"div\").attr(\"class\",\n    \"tooltip hidden\").attr(\"aria-hidden\", \"true\");\n\n  var infoContainer = d3.select(\"main\").append(\"div\")\n  .attr(\"class\",\"infoContainer hidden\")\n  .attr(\"id\", \"infoContainer\")\n  .attr(\"role\", \"region\")\n  .attr(\"aria-labelledby\", \"music-from cname-heading\")\n\n    var cnameDiv = d3.select(\"#infoContainer\").append(\"div\").attr(\"class\",\n  \"cnameDiv\").attr(\"id\", \"cname\");\n  \n    var artistContainer = d3.select(\"#infoContainer\").append(\"div\").attr(\"class\",\n    \"artistContainer\").attr(\"id\", \"artistContainer\");\n\n\n  var detailsDiv = d3.select(\"#artistContainer\").append(\"div\").attr(\"class\",\n    \"detailsDiv\").attr(\"id\", \"details\");\n\n  var recoDiv = d3.select(\"#artistContainer\").append(\"div\").attr(\"class\",\n    \"recoDiv\").attr(\"id\", \"recommendations\");\n\n  var artistSummaryDiv = d3.select(\"#artistContainer\").append(\"div\").attr(\"class\",\n    \"artistSummaryDiv\").attr(\"id\", \"summary\");\n\n  var closeButton;\n\n  var offsetL;\n  var offsetT;\n\n  //---------------------- Color preferences -------------//\n  var themes = {\n    blue_black: [\"#03020D\", \"#140E1F\", \"#2A075A\", \"#321C78\", \"#362688\", \"#3E3CA7\", \"#4651C5\", \"#5371F4\"],\n    green_black: [\"#03020D\", \"#08120C\", \"#032F30\", \"#064137\", \"#0E6745\", \"#158C54\", \"#1CB162\", \"#28EA78\"],\n    pink_black: [\"#03020D\", \"#1F0310\", \"#4B0627\", \"#5C1138\", \"#7E285C\", \"#A13F80\", \"#C355A4\", \"#F778DA\"],\n    pink_white: [\"#feebe2\", \"#feebe2\", \"#fcc5c0\", \"#fa9fb5\", \"#f768a1\", \"#dd3497\", \"#ae017e\", \"#7a0177\"],\n    green_white: [\"#ece2f0\", \"#F6EBFA\", \"#ccece6\", \"#99d8c9\", \"#66c2a4\", \"#41ae76\", \"#238b45\", \"#006d2c\"],\n    red_white: [\"#F0F0D8\", \"#F0F0D8\", \"#feb24c\", \"#fd8d3c\", \"#fc4e2a\", \"#e31a1c\", \"#bd0026\", \"#800026\"],\n  };\n\n  let nextTheme = window.nextTheme = function(toTheme) {\n    // Go to next theme\n    var themeList = d3.keys(themes);\n    theme = toTheme || themeList[(themeList.indexOf(theme) + 1) % themeList.length];\n    colorArray = themes[theme];\n\n    // Change body class\n    let bodyClass = [\"blue_black\", \"green_black\", \"pink_black\"].includes(theme) ? \"dark\" : \"light\";\n    bodyClass += \" \" + theme;\n    d3.select(document.body).attr(\"class\", bodyClass);\n\n    // Save :)\n    window.localStorage.theme = theme;\n\n    // Redraw map :)\n    if (topo) redraw();\n\n    // Annunce to screen readers\n    announcer.announce(`Theme changed to ${theme}`);\n  }\n  map.nextTheme = nextTheme;\n\n  nextTheme(theme);\n  updateScale();\n  updateDimensions();\n  setup(width, height);\n  keyboardMode.init(zoom, move, width, height, MAX_ZOOM);\n\n  function setup(width, height) {\n    projection = d3.geo.naturalEarth()\n      .translate([(width / 2), (height / 2) + height * 0.08])\n      .scale(width / 1.7 / Math.PI);\n\n    path = d3.geo.path().projection(projection);\n    \n    // Export path and projection for use in keyboard-mode.js\n    map.path = path;\n    map.projection = projection;\n\n    svg = d3.select(\"#map-container\")\n      .attr(\"role\", \"application\")\n      .append(\"svg\")\n      .attr(\"role\", \"img\")\n      .attr(\"tabindex\", \"0\")\n      .attr(\"aria-labelledby\", \"map-label\")\n      // .attr(\"aria-describedby\", \"map-hint\")\n      .attr(\"id\", \"map-svg\")\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .style(\"margin-left\", document.getElementById(\"map-container\").offsetWidth / 2 - width / 2)\n      .call(zoom)\n      .on(\"click\", click)\n      .append(\"g\");\n\n    g = svg.append(\"g\");\n    svg.append(\"g\").attr(\"id\", \"legend\")\n    svg.append(\"text\").attr({\n      id: \"filter-text\",\n      class: \"legend\"\n    });\n    svg.append(\"text\").attr({\n      id: \"filter\",\n      class: \"legend\"\n    });\n\n    map.zoom = zoom; // Export the zoom behavior\n  }\n\n  //Load country aliases and names\n  api.getCountriesData().then(countries => (map.countryNames = countryNames = countries));\n  \n  //Load map\n  d3.json(\"assets/data/world-50m.json\", function(error, world) {\n\n    var countries = topojson.feature(world, world.objects.countries).features;\n\n    topo = countries;\n    draw(topo, true);\n\n  });\n\n  function draw(topo, redrawMap) {\n    var country = g.selectAll(\".country\").data(topo);\n\n    var progress = d3.select(\"#progress-bar\").style({\n      \"height\": updateProgressBar() * 100 + \"%\",\n      \"background-color\": colorArray[6]\n    });\n    d3.select(\"#countryCount\").style({\n      \"background-color\": colorArray[1],\n      \"border-color\": colorArray[6]\n    })\n    //Show progressbar text on mouse-over\n    .on(\"mousemove\", function() {\n      d3.select(\"#progress-text\")\n        .transition().duration(prefersReducedMotion ? 0 : 150).style(\"opacity\", 0.9);\n    })\n      .on(\"mouseout\", function() {\n        d3.select(\"#progress-text\").transition().duration(prefersReducedMotion ? 0 : 150).style(\"opacity\", 0);\n      });\n    d3.select(\"#progress-text\").html(\"Scrobbled from \" + countryScore + \"/210 countries\").attr(\"aria-hidden\", \"true\");\n\n    //Draw countries\n    if (redrawMap) {\n      country.enter().insert(\"path\")\n        .attr(\"class\", \"country\")\n        .attr(\"d\", path)\n        .attr(\"id\", function(d, i) {\n          return `c${d.id}`;\n        })\n        .attr(\"title\", function(d, i) {\n          return d.properties.name;\n        })\n        .attr(\"data-center-x\", function(d, i) {\n          return getCountryCenter(d).x;\n        })\n        .attr(\"data-center-y\", function(d, i) {\n          return getCountryCenter(d).y;\n        })\n        .style(\"fill\", function() {\n          return color(0);\n        })\n        .style(\"transform-origin\", function (d) {\n          const center = getCountryCenter(d);\n          return `${-center.x}px ${-center.y}px`;\n        });\n    }\n    //Color countries\n    country.transition().style(\"fill\", function(d) {\n      switch (filter) {\n        case \"artists\":\n          return countryCount[d.id] ? color(countryCount[d.id].length) :\n            color(0);\n          //break;\n        case \"scrobbles\":\n          return color(getCountryPlaycount(d));\n      }\n    })\n\n    //offsets for tooltips\n    offsetL = document.getElementById('map-container').offsetLeft;\n    offsetT = document.getElementById('map-container').offsetTop;\n\n    //tooltips\n    country\n      .on(\"mousemove\", function(d, i) {\n        var name;\n        var tag;\n        countryNames.forEach(function(e, i) {\n          if (e.id === d.id) {\n            name = e.name;\n            tag = e.tag;\n          };\n        })\n        var mouse = d3.mouse(svg.node()).map(function(d) {\n          return parseInt(d);\n        });\n\n        tooltip.classed(\"hidden\", false)\n          .attr(\"style\", \"left:\" + (mouse[0] + offsetL + 20) + \"px;top:\" + (\n            mouse[1] +\n            offsetT + 10) + \"px\")\n          .html(name + (countryCount[d.id] ? \"<br>\" + countryCount[d.id].length + \" artists, \" + numbersWithSpace(getCountryPlaycount(d)) + \" scrobbles\" : \"\"));\n      })\n      .on(\"mouseout\", function(d, i) {\n        tooltip.classed(\"hidden\", true);\n      })\n      //Show div with top 10 artists for country when clicked\n      .on(\"click\", function(d, i) {\n        var name;\n        var tag;\n        var id;\n\n        clicked(d);\n\n        countryNames.forEach(function(e, i) {\n          if (e.id === d.id) {\n            name = e.name;\n            tag = e.tag;\n            id = d.id;\n          };\n        })\n        var mouse = d3.mouse(svg.node()).map(function(d) {\n          return parseInt(d);\n        });\n\n        closeButton\n          .on(\"click\", function(d, i) {\n            removeArtistDiv();\n            // zoom out map, fulhack\n            clicked(centered);\n          }) //\"stng\" onclick slutar\n      }) // on click slutar\n\n  }\n\n  /*-------redraw----*/\n  //den kallas varje gng datan uppdateras. redrawMap r en boolean\n  function redraw(redrawMap) {\n    updateDimensions();\n\n    if (redrawMap) {\n      d3.select('#map-svg').remove();\n      setup(width, height);\n    }\n\n    maxartists = d3.max(d3.keys(countryCount), function(cname) {\n      return countryCount[cname].length;\n    });\n    maxplaycount = d3.max(d3.keys(countryCount), function(cname) {\n      return getCountryPlaycount({\n        id: cname\n      });\n    })\n    updateScale();\n    updateLegend();\n\n    draw(topo, redrawMap);\n  }\n\n\n  /**\n   * Moves the map to the specified location or based on the current zoom event\n   * @param  {Array} tr      Optional: Translation tuple [x, y]\n   * @param  {Number} sc      Optional: Scale factor\n   * @param  {Boolean} animate Optional: Decides whether to animate the map movement\n   * @param  {Boolean} withKeyboard If the move was initiated by the keyboard\n   */\n  function move(tr, sc, animate, withKeyboard) {\n    // Check if we should activate keyboard mode\n    if (sc >= MIN_ZOOM_LEVEL_FOR_KEYBOARD_MODE) {\n      // Pass the zoom object to updateVisibleCountries\n      keyboardMode.updateVisibleCountries(zoom);\n    } else {\n      keyboardMode.cleanup();\n    }\n    \n    var t = tr || (d3.event ? d3.event.translate : false) || zoom.translate();\n    var s = sc || (d3.event ? d3.event.scale : false) || zoom.scale();\n\n    // If move was not initiated by clicking on a country, deselect the selected country\n    if (!tr && !sc && centered) {\n      highlightCountry(false);\n      removeArtistDiv();\n      centered = null;\n    }\n\n    var zscale = s;\n    var h = height / 4;\n\n    t[0] = Math.min(\n      (width / height) * (s - 1),\n      Math.max((width * 1.2) * (1 - s), t[0])\n    );\n\n    t[1] = Math.min(\n      h * (s - 1) + h * s,\n      Math.max(height * (1 - s) - h * s, t[1])\n    );\n\n    zoom.translate(t);\n    zoom.scale(s);\n\n    if (animate) {\n      g.transition().duration(prefersReducedMotion ? 0 : 950).attr(\"transform\", \"translate(\" + t + \")scale(\" + s + \")\");\n\n    } else {\n      g.attr(\"transform\", \"translate(\" + t + \")scale(\" + s + \")\");\n    }\n\n    //adjust the country hover stroke width based on zoom level\n    d3.selectAll(\".country\").style(\"stroke-width\", 1.5 / s);\n  }\n  map.move = move;\n\n  var throttleTimer;\n\n  function throttle() {\n    window.clearTimeout(throttleTimer);\n    throttleTimer = window.setTimeout(function() {\n      redraw(true);\n      move([0, 0], 1); // Reset position\n    }, 200);\n  }\n\n\n  //geo translation on mouse click in map\n  function click() {\n    var latlon = projection.invert(d3.mouse(this));\n    // console.log(latlon);\n    //console.log(countryCount);\n  }\n\n  function showArtists(pageNumber, itemsPerPage) {\n    const start = (pageNumber - 1) * itemsPerPage;\n    const end = start + itemsPerPage;\n    const pageItems = artists.slice(start, end);\n\n    // Clear the details section\n    d3.selectAll(\".artist-li\").remove();\n\n    // Append the artists to the details section\n    pageItems.forEach(artist => {\n      var artistDiv = d3.select(\"#top-artist-list\")\n      .append(\"li\")\n        .attr(\"class\", \"artist-li\")\n      .append(\"button\")\n        .attr({\n          \"class\": `scrobbled artist-div lowlight`,\n          \"data-artist\": artist.artist\n        })\n        .on(\"click\", function() {\n          // Lowlight not selected artists\n          d3.selectAll(\".artist-div\").classed({\n            \"lowlight\": true,\n            \"highlight\": false\n          });\n          // Highlight selected artist\n          d3.select(this).classed({\n            \"highlight\": true,\n            \"lowlight\": false\n          });\n          d3.selectAll(\".artist-div\").attr(\"aria-pressed\", \"false\");\n          d3.select(this).attr(\"aria-pressed\", \"true\");\n\n          makeSummaryDiv(d3.select(this).attr(\"data-artist\"), []);\n        });\n      \n      var artistLink = artistDiv.append(\"div\").style(\"display\", \"block\")\n      artistLink.append(\"div\")\n        .attr(\"class\", \"artist-image image-div\");\n\n      var playCountDiv = artistDiv.append(\"div\").attr(\"class\", \"play-count-div\");\n\n      playCountDiv.append(\"p\")\n        .html(\"<strong>\" + artist.artist + \"</strong><br>\" + artist.playcount + \" scrobbles\")\n        .attr(\"class\", \"details-p\");\n    });\n\n    // Update the state of the navigation buttons\n    d3.select(\".artist-control.left\").attr(\"disabled\", currentPage === 1 ? \"disabled\" : null);\n    d3.select(\".artist-control.right\").attr(\"disabled\", currentPage === Math.ceil(artists.length / itemsPerPage) ? \"disabled\" : null);\n}\n\n  function showNextFive() {\n      if (currentPage < artists.length / itemsPerPage) {\n          currentPage++;\n          showArtists(currentPage, itemsPerPage);\n          // Give feedback to screen readers\n          announcer.announce(\"Showing next five artists\", \"polite\");\n          //Send event to google analytics\n          ga('send', {\n            hitType: 'event',\n            eventCategory: 'Artist viewer',\n            eventAction: 'Next five',\n            eventLabel: 'test'\n          });\n      }\n  }\n\n  function showPreviousFive() {\n      if (currentPage > 1) {\n          currentPage--;\n          showArtists(currentPage, itemsPerPage);\n          // Give feedback to screen readers\n          announcer.announce(\"Showing previous five artists\", \"polite\");\n          //Trigger GA event\n          ga('send', {\n            hitType: 'event',\n            eventCategory: 'Artist viewer',\n            eventAction: 'Previous five',\n            eventLabel: 'test'\n          });\n      }\n  }\n\n  function searchArtist(name) {\n    const index = artists.findIndex(artist => artist.artist.toLowerCase() === name.toLowerCase());\n\n    if (index !== -1) {\n        currentPage = Math.floor(index / itemsPerPage) + 1;\n        showArtists(currentPage, itemsPerPage);\n        setTimeout(() => {\n          const artist = document.querySelector(`[data-artist=\"${name}\"]`);\n          artist?.click();\n          setTimeout(() => {\n            artist?.focus();\n          }, 50); \n        }, 250);\n    }\n  }\n\n  /*----------------------------makeArtistDiv------------------------------------------------*/\n  //Skapar \"details-on-demand\"-divarna.\n  // d r det land vi klickat p\n  // artistName r ett artistnamn vi vill zooma in p\n  function makeArtistDiv(d) {\n\n    countryDivIsOpen = true;\n    currentCountry = d;\n\n    //lgga till namn till detailseDiv\n    var name;\n    var tag;\n    var nameTags;\n    var tagTags;\n    var recoms;\n    //var id;\n    countryNames.forEach(function(e, i) {\n      if (e.id === d.id) {\n        name = e.name;\n        tag = e.tag;\n\n        nameTags = (e.names || [e.name]).map(n => \"<span class=\\\"demonym\\\">\" + n + \"</span>\").join(\", \");\n        tagTags = (e.tags || [e.tag]).map(t => \"<span class=\\\"demonym\\\">\" + t + \"</span>\").join(\", \");\n      };\n    })\n    d3.select(\"#recommendations\").html(\"\");\n    //Show country name and info div on left hand side\n    infoContainer\n      .classed(\"hidden\", false)\n      .transition()\n      .style(\"opacity\", 1)\n      .duration(prefersReducedMotion ? 0 : 750);\n\n    //Hide progressbar when showing\n    d3.selectAll(\"#countryCount, .on-map-view\")\n      .classed(\"hidden\", true);\n\n    closeButton = d3.select('#infoContainer').append(\"button\").attr(\"type\", \"button\").attr(\"aria-label\", `Close ${name}`).attr(\"class\", \"close-button fa fa-xmark\");\n\n    //Populate country information div\n    cnameDiv\n      .append(\"div\").attr(\"class\", \"cnameContainer\").attr(\"id\", \"cnameCont\")\n      .append(\"h1\").html(name)\n      .attr(\"id\", \"cname-heading\");\n    d3.select(\"#cnameCont\").append(\"strong\")\n      .html(function() {\n        if (countryCount[d.id])\n          return numbersWithSpace(countryCount[d.id].length) + \" artists, \" + numbersWithSpace(getCountryPlaycount(d)) + \" scrobbles\"\n        else return \"No artists yet - Find new here<span aria-hidden> -></span>\"\n      })\n\n    let pl = countryPlaylists.find(c => c.name === name);\n    let linkdiv = d3.select(\"#cnameCont\")\n      .append(\"div\").attr(\"class\", \"playlist-link\")\n\n   let lastFmLink =  linkdiv.append(\"a\").attr(\"href\", \"https://last.fm/tag/\" + name)\n   lastFmLink.append(\"img\").attr(\"alt\", \"Last.fm tag\").attr(\"class\", \"playlist-link__img\").attr(\"src\", \"https://www.shareicon.net/data/32x32/2016/05/24/769923_logo_512x512.png\").attr(\"style\",\"background:none\");\n   lastFmLink.append(\"span\").html(\"#\"+name);\n\n    if (pl) {\n\n      linkdiv.append(\"span\").attr(\"class\",\"divider\").html(\"/\").attr(\"aria-hidden\", \"true\");\n\n      let a = linkdiv.append(\"a\").attr(\"href\", pl.uri).attr(\"target\", \"_self\");\n\n      a.append(\"img\")\n        .attr(\"alt\", \"Spotify playlist\")\n        .attr(\"class\", \"playlist-link__img\")\n        .attr(\"src\", \"https://upload.wikimedia.org/wikipedia/commons/1/19/Spotify_logo_without_text.svg\");\n\n      a.append(\"span\").html(pl.playlistName);\n\n    }\n\n    if (countryCount[d.id]) { //Om landet vi klickat p har lyssnade artister.\n\n      d3.select(\"#details\").append(\"h2\")\n        .html(\"<span>Your top artists tagged with </span>\" + nameTags + \"<span> or </span>\" + tagTags + \"<span>: </span>\")\n        .attr(\"class\", \"topartists-desc\").attr(\"id\", \"top-artist-list-heading\");\n      \n        currentPage = 1;\n        itemsPerPage = 5;\n        artists = countryCount[d.id]; // Your artists data goes here\n        d3.select(\"#details\").append(\"div\").attr(\"id\", \"top-artist-list-container\");\n\n        d3.select(\"#top-artist-list-container\").append(\"ol\").attr(\"id\", \"top-artist-list\").attr(\"aria-labelledby\", \"top-artist-list-heading\");\n      \n        d3.select(\"#top-artist-list-container\").append(\"button\").attr(\"class\", \"fa artist-control left fa-angle-left\").attr(\"aria-label\", \"Previous five artists\");\n        d3.select(\"#top-artist-list-container\").append(\"button\").attr(\"class\", \"fa artist-control right fa-angle-right\").attr(\"aria-label\", \"Next five artists\");\n        \n        // Event listeners for the navigation buttons\n        d3.select(\".artist-control.left\").on(\"click\", showPreviousFive);\n        d3.select(\".artist-control.right\").on(\"click\", showNextFive);\n        \n        \n        // Initial display of artists\n        showArtists(currentPage, itemsPerPage);\n\n\n    } else { //Om landet vi klickat p inte har ngra lyssnade artister...\n      // console.log(\"landet har inga lyssnade artister\");\n    }\n    //\"Recommended\"-heading\n    d3.select(\"#recommendations\")\n    .append(\"h2\")\n      .html(\"You may like: \")\n      .attr(\"id\", \"recom-heading\")\n      .attr(\"class\", \"topartists-desc\");\n    d3.select(\"#recommendations\")\n      .append(\"ul\")\n        .attr(\"id\", \"recom-list\")\n        .attr(\"aria-labelledby\", \"recom-heading\")\n        .classed(\"hidden\", false);\n\n    // show loading message\n    var recLoadingDiv = d3.select(\"#recommendations\").append(\"div\").attr(\"class\", \"recLoadingDiv\");\n    var recLoadingMessage = recLoadingDiv.append(\"span\")\n      .attr(\"id\", \"rec-loading\")\n      .html(\"Looking for artists tagged #\" + tag);\n    recLoadingDiv.append(\"img\")\n      .attr({\n        id: \"rec-loading-img\",\n        src: \"assets/img/loader_horizontal.gif\",\n        alt: \"Loading...\"\n      })\n      .style({\n        display: \"inline-block\",\n        margin: \"0 5px\"\n      })\n    recLoadingDiv.append(\"span\").attr(\"id\", \"rec-loading-current\");\n\n\n\n    //Get list of recommendations for country based on tags!\n    api.getRecommendations(tag, function(taglist) {\n      // Return if this callback is from an old (not active) country\n      if (!centered || centered.id !== d.id) {\n        return;\n      }\n      // Show loading message\n      recLoadingMessage.html(\"Looking for artists tagged #\" + name)\n\n      //Get list of recommendations for country based on country name!\n      api.getRecommendations(name, function(namelist) {\n        // Return if this callback is from an old (not active) country\n        if (!centered || centered.id !== d.id) {\n          return;\n        }\n        //Show loading message\n        recLoadingMessage.html(\"Loading images for recommended artists\");\n\n        //Join the two lists\n        var list = taglist.concat(namelist);\n\n        //Removing duplicates from the list!\n        var arr = {};\n        for (let i = 0; i < list.length; i++)\n          arr[list[i]['name']] = list[i];\n\n        list = new Array();\n        for (let key in arr)\n          list.push(arr[key]);\n\n        list.sort(function(a, b) {\n          return b.count < a.count ? -1 : b.count > a.count ? 1 : 0;\n        });\n        //Get the first 20 artists\n        list = list.slice(0, 20);\n        //Randomize list\n        list = shuffleArray(list);\n\n        if (list.length === 0) { // Found no recommendations\n          recLoadingDiv.remove();\n          d3.select(\"#recommendations\").append(\"p\")\n            .html(\"We couldn't find any good \" + tag + \" recommendations for you :-( \");\n          d3.select(\"#recommendations\").append(\"a\").attr({\n            href: \"https://www.last.fm/tag/\" + name,\n            target: \"_blank\",\n          }).html(\"Try searching last.fm yourself!\");\n        }\n\n        for (let i = 0; i < Math.min(list.length, 5); i++) {\n          // Return if this callback is from an old (not active) country\n          if (centered.id !== d.id) {\n            return;\n          }\n\n          var artisturl, artistimg, artistname;\n\n          //Get url and images for recommended artists!\n          api.getArtistInfo(list[i].name, function(art) {\n            recLoadingDiv.remove();\n            var artisturl = art[0].url;\n            var artistimg = art[0].image;\n            var artistname = art[0].name;\n\n\n            var recoArtistDiv = d3.select(\"#recom-list\")\n              .append(\"li\")\n              .insert(\"button\", \"#summaryText\")\n              .attr(\"type\", \"button\")\n              .attr(\"class\", \"artist-div lowlight\");\n            var recoArtistLink = recoArtistDiv.append(\"div\").style(\"display\", \"block\")\n              //.attr(\"href\", artisturl)\n              //.attr(\"target\", \"_blank\");\n            recoArtistLink.append(\"div\")\n              .attr(\"class\", \"image-div\")\n              .style(\"background-image\", \"url(\" + \"'\" + artistimg + \"'\" + \")\")\n\n            var recoArtistInfoDiv = recoArtistDiv.append(\"div\").attr(\"class\", \"recoArtistInfoDiv\");\n\n            recoArtistInfoDiv.append(\"p\")\n              .html(artistname)\n              .attr(\"class\", \"details-p\");\n\n            recoArtistDiv.on(\"click\", function() {\n              d3.selectAll(\".artist-div\").classed({ // Lowlight not selected artists\n                \"lowlight\": true,\n                \"highlight\": false\n              });\n\n              d3.select(this).classed({ // Highlight selected artist\n                \"highlight\": true,\n                \"lowlight\": false\n              });\n              makeSummaryDiv(artistname);\n            });\n\n          })\n        }\n\n\n      })\n    });\n\n  }\n\n  function removeArtistDiv() {\n    countryDivIsOpen = false;\n    currentCountry = null;\n    api.cancelRecommendationRequests();\n\n    infoContainer.transition().style(\"opacity\", 0).duration(prefersReducedMotion ? 0 : 1000);\n\n    infoContainer.classed(\"hidden\", true);\n\n    // Restore toolbar\n    d3.selectAll(\"#countryCount, .on-map-view\")\n      .classed(\"hidden\", false);\n\n    d3.select(\"#details\").html(\"\");\n    d3.select(\"#recommendations\").html(\"\");\n    d3.select(\"#cname\").html(\"\");\n    d3.selectAll(\".artist-control\").remove();\n    d3.select(\".close-button\").remove();\n    d3.selectAll(\"#top-artist-list\").remove();\n  }\n\n  function makeSummaryDiv(artistname) {\n    var usertaglist = [];\n    var artisttaglist = [];\n\n    d3.select(\"#summaryText\").remove();\n    var summaryText = d3.select(\"#recommendations\").append(\"div\").attr(\"class\", \"summaryText\").attr(\"id\", \"summaryText\");\n    d3.select(\"#summaryText\").append(\"span\").html(\"Loading description of \" + artistname);\n    d3.select(\"#summaryText\").append(\"img\")\n      .attr({\n        id: \"sum-loading-img\",\n        src: \"assets/img/loader_horizontal.gif\"\n      })\n      .style({\n        display: \"inline-block\",\n        margin: \"0 5px\"\n      });\n\n    //Get artist info from Lastfm\n    api.getArtistInfo(artistname, function(art) {\n      var paragraphs = art[0].description.split(/(\\n)+/g);\n      //var text = text.substring(6);\n      //Get artist's top tags\n      artisttaglist = art[0].tags;\n      //Create list of user tags\n\n      //Make list of artist tags which are also user's top tags:\n      for (let y = 0; y < 15; y++) {\n        for (let z = 0; z < artisttaglist.length; z++) {\n          if (artisttaglist[z] === USER_TAGS[y].tag) {\n            usertaglist.push(USER_TAGS[y].tag)\n          }\n        }\n      }\n\n      //Create combined tag list and remove duplicates\n      var taglist = usertaglist.concat(artisttaglist);\n      taglist = taglist.filter(function(elem, pos) {\n        return taglist.indexOf(elem) == pos;\n      })\n      // Remove loading text\n      d3.select(\"#summaryText\").html(\"\");\n      //Create containing div\n      // Calculate height of infotextbox (so the scrollbar is inside the box and not on body)\n      var h = window.innerHeight * 0.90 - document.getElementById(\"artistContainer\").offsetHeight;\n      summaryText.style(\"max-height\", h + \"px\");\n\n      summaryText.append(\"h2\").html(artistname).attr(\"id\", \"artistname\");\n\n      const tags = summaryText.append(\"ul\").attr(\"class\", \"taglist\").attr(\"aria-labelledby\", \"tags-for artistname\");\n\n      //Show top 7 tags\n      for (let i = 0; i < Math.min(taglist.length, 6); i++) {\n        var tagdiv = tags.append(\"li\").attr(\"class\", \"tagdiv\").html(taglist[i]);\n        //Mark all user tags\n        for (let p = 0; p < usertaglist.length; p++) {\n          if (taglist[i] === usertaglist[p])\n            tagdiv.classed(\"usertag\", true);\n        }\n      }\n      //Display artist summary\n      paragraphs.forEach(function(paragraph) {\n        summaryText.append(\"p\").html(paragraph || \"No description available - <a href='https://last.fm/music/\" + artistname + \"' target='_blank'>check out last.fm.</a>\");\n      });\n\n    })\n\n  }\n\n  /**\n   * Toggles highlight of a specified country\n   * @param  {Boolean} highlight      Specifies whether to highlight or \"dehighlight\"\n   * @param  {Object} countryElement The country element to highlight (needs to have an \"id\" property)\n   */\n  function highlightCountry(highlight, countryElement) {\n    d3.selectAll(\".country\").classed(\"highlighted\", false);\n\n    if (highlight) {\n      // Fade out all other countries\n      d3.selectAll(\".country\").transition()\n        .style(\"opacity\", function() {\n          return (this.id === `c${countryElement.id}` ? 1.0 : 0.3);\n        })\n\n      var ce = d3.select(document.getElementById(`c${countryElement.id}`));\n      ce.classed(\"highlighted\", true);\n    } else {\n      // Fade in all countries\n      d3.selectAll(\".country\").transition()\n        .style(\"opacity\", 1.0)\n    }\n}\n\n\n  function clicked(d) { //d r det en har klickat p\n\n    keyboardMode.cleanup();\n\n    var x, y, k;\n    //bounding box for clicked country\n    var b = path.bounds(d);\n\n    getCountryPlaycount(d);\n\n    //Set scale\n    var modscaleX = (b[1][0] - b[0][0]);\n    var modscaleY = (b[1][1] - b[0][1]);\n\n    //Dom't zoom too far with small countries!\n    if (modscaleX < 80)\n      modscaleX = 80;\n\n    //Landet r inte centrerat redan\n    if (d && centered !== d) {\n      centered = d;\n      removeArtistDiv();\n      makeArtistDiv(d);\n      highlightCountry(true, d);\n\n      announcer.announce(`Opened ${countryNames.find(c => c.id === d.id).name}`, \"assertive\");\n\n      //Special rules for special countries:\n      switch (d.id) {\n        case 840: //US\n          k = 3;\n          x = -(b[1][0] + b[0][0]) / 3;\n          y = -(b[1][1] + b[0][1]) / 1.7;\n          break;\n        case 250: //France\n          k = 7.012;\n          x = -(b[1][0] + b[0][0]) / 1.85;\n          y = -(b[1][1] + b[0][1]) / 3;\n          break;\n        case 528: //Netherlands\n          k = 12.0124;\n          x = -(b[1][0] + b[0][0]) / 1.56;\n          y = -(b[1][1] + b[0][1]) / 2.7;\n          break;\n        case 643: //Russia\n          k = 1.9;\n          x = -(b[1][0] + b[0][0]) / 1.25;\n          y = -(b[1][1] + b[0][1]) / 2;\n          break;\n        case 554: //New Zeeland\n          k = 4;\n          x = -(b[1][0] + b[0][0]) / 0.90;\n          y = -(b[1][1] + b[0][1]) / 1.8;\n          break;\n        case 36: //Australia\n          k = 3.3;\n          x = -(b[1][0] + b[0][0]) / 1.8;\n          y = -(b[1][1] + b[0][1]) / 2.1;\n          break;\n\n        default: //Everybody else\n          k = .55 / Math.max(modscaleX / width, modscaleY / height);\n          x = -(b[1][0] + b[0][0]) / 2 - (width / k) / 4;\n          y = -(b[1][1] + b[0][1]) / 2;\n          break;\n      }\n\n      //Landet r redan centrerat\n    } else {\n      announcer.announce(`Left ${countryNames.find(c => c.id === d.id).name}`, \"assertive\");\n      x = -width / 2;\n      y = -height / 2 - height * 0.08;\n      k = 1\n      removeArtistDiv();\n      highlightCountry(false);\n      centered = null;\n      // Refocus the map svg (mainly for screen readers)\n      document.getElementById(\"map-svg\").focus( { \n        preventScroll: true\n       } );\n\n    }\n\n    var pt = projection.translate();\n    // Tell map to move with animation\n    // Basically does the same as before: translate to middle,\n    // then to x and y with respect to scale\n    move([pt[0] + x * k, pt[1] + y * k], k, !prefersReducedMotion);\n\n  }\n\nfunction dismissCenteredCountry() {\n  removeArtistDiv();\n  highlightCountry(false);\n  centered = null;\n}\n\n// Add this helper function\nfunction getBBoxCenter(bbox) {\n  const [west, south, east, north] = bbox;\n  // For countries that cross the date line, handle the longitude calculation specially\n  const centerLon = west > east ? (west + east + 360) / 2 % 360 : (west + east) / 2;\n  const centerLat = (north + south) / 2;\n  return [centerLon, centerLat];\n}\n\n// Modify the getCountryCenter function\nfunction getCountryCenter(countryTopoData) {\n  // Check if we have a custom bounding box for this country\n  const countryId = countryTopoData.id;\n  if (COUNTRY_BBOX_OVERRIDES && COUNTRY_BBOX_OVERRIDES[countryId]) {\n    // Use the first bounding box for the center (usually the main territory)\n    const overrides = COUNTRY_BBOX_OVERRIDES[countryId];\n    const mainBBox = Array.isArray(overrides[0]) ? overrides[0] : overrides;\n    \n    // Calculate the center of the bounding box\n    const center = getBBoxCenter(mainBBox);\n    \n    // Project the center to screen coordinates\n    const projected = projection(center);\n    return {\n      x: -projected[0],\n      y: -projected[1]\n    };\n  }\n  \n  // Fall back to the existing logic for countries without overrides\n  let x, y;\n  let b = path.bounds(countryTopoData);\n\n  //Special rules for special countries:\n  switch (countryTopoData.id) {\n    case 840: //US\n      x = -(b[1][0] + b[0][0]) / 4;\n      y = -(b[1][1] + b[0][1]) / 1.9;\n      break;\n    case 250: //France\n      x = -(b[1][0] + b[0][0]) / 1.94;\n      y = -(b[1][1] + b[0][1]) / 2.81;\n      break;\n    case 528: //Netherlands\n      x = -(b[1][0] + b[0][0]) / 1.605;\n      y = -(b[1][1] + b[0][1]) / 2.54;\n      break;\n    case 643: //Russia\n      x = -(b[1][0] + b[0][0]) / 1.40;\n      y = -(b[1][1] + b[0][1]) / 2;\n      break;\n    case 554: //New Zeeland\n      x = -(b[1][0] + b[0][0]) / 1.03;\n      y = -(b[1][1] + b[0][1]) / 1.87;\n      break;\n    case 36: //Australia\n      x = -(b[1][0] + b[0][0]) / 2;\n      y = -(b[1][1] + b[0][1]) / 2.1;\n      break;\n\n    default: //Everybody else\n      x = -(b[1][0] + b[0][0]) / 2;\n      y = -(b[1][1] + b[0][1]) / 2;\n      break;\n  }\n\n  return { x, y };\n}\n\n  // Close the country div on escape\n  window.addEventListener('keydown', function(evt) {\n    if ((evt.key === 'Escape' || evt.keyCode === 27) && countryDivIsOpen) {\n      console.log(\"Escape pressed\");\n      removeArtistDiv();\n      // zoom out map, fulhack\n      clicked(centered);\n    }\n  });\n\n  //function to add points and text to the map (used in plotting capitals)\n  function addpoint(lat, lon, text) {\n\n    var gpoint = g.append(\"g\").attr(\"class\", \"gpoint\");\n    var x = projection([lat, lon])[0];\n    var y = projection([lat, lon])[1];\n\n    gpoint.append(\"svg:circle\")\n      .attr(\"cx\", x)\n      .attr(\"cy\", y)\n      .attr(\"class\", \"point\")\n      .attr(\"r\", 1.5);\n\n    //conditional in case a point has no associated text\n    if (text.length > 0) {\n\n      gpoint.append(\"text\")\n        .attr(\"x\", x + 2)\n        .attr(\"y\", y + 2)\n        .attr(\"class\", \"text\")\n        .text(text);\n    }\n\n  }\n\n  function animateCountries(countryDict) {\n    const userPrefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\n    var countries = g.selectAll(\".country\").filter(c => !!countryDict[c.id]);\n\n    setTimeout(() => {\n      // bounce - didn't look too good but might be fun to try again\n      // later\n      \n      // countries.transition()\n      // .duration(200)\n      // .style(\"transform\", \"scale(1.1)\")\n      // .delay((_, i) => i * 100)\n      // .transition().duration(150)\n      // .style(\"transform\", \"scale(1)\");\n\n      // fade\n      // Only do the bing bong thing if the user doesn't prefer reduced motion\n      if (!userPrefersReducedMotion) {\n        countries.transition()\n        .duration(200)\n        .style(\"opacity\", \"0.8\")\n        .delay((_, i) => i * 100)\n        .transition().duration(150)\n        .style(\"opacity\", \"1\");\n      }\n      \n    })\n  }\n\n  function putCountryCount(newArtists) {\n    Object.entries(newArtists).forEach(([key, value]) => {\n      countryCount[key] = (countryCount[key] || []).concat(value);\n    });\n\n    countryScore = 0;\n\n    d3.keys(countryCount).forEach(function (id) {\n      countryScore = countryScore + 1;\n    })\n\n    if (topo) redraw();\n\n    window.countryScore = countryScore;\n  }\n\n  /** \"PUBLUC\" FUNCTIONS **/\n  \n  map.addArtists = function (newArtistsByCountry) {\n    putCountryCount(newArtistsByCountry);\n    animateCountries(newArtistsByCountry);\n  }\n\n  map.getCountryCenter = getCountryCenter;\n\n  map.makeSummaryDiv = makeSummaryDiv;\n\n  map.showArtists = showArtists;\n\n  map.searchArtist = searchArtist;\n\n  map.centered = centered;\n\n  map.dismissCenteredCountry = dismissCenteredCountry;\n\n  map.toggleFilter = function() {\n    filter = filter === \"artists\" ? \"scrobbles\" : \"artists\";\n    updateLegend();\n    redraw();\n  }\n\n  // Find the function that handles the zoom/fit behavior, likely something like:\n  function fitToCountry(countryFeature) {\n    if (countryFeature.id && COUNTRY_BBOX_OVERRIDES[countryFeature.id]) {\n      const overrides = COUNTRY_BBOX_OVERRIDES[countryFeature.id];\n      const boxArray = Array.isArray(overrides[0]) ? overrides : [overrides];\n      \n      // Find the overall bounding box that encompasses all boxes\n      const allBounds = boxArray.reduce((acc, bbox) => {\n        const [west, south, east, north] = bbox;\n        return {\n          west: Math.min(acc.west, west),\n          south: Math.min(acc.south, south),\n          east: Math.max(acc.east, east),\n          north: Math.max(acc.north, north)\n        };\n      }, {west: 180, south: 90, east: -180, north: -90});\n      \n      const bounds = [[allBounds.west, allBounds.south], [allBounds.east, allBounds.north]];\n      \n      // Use your existing zoom/fit logic with these bounds\n      const [[x0, y0], [x1, y1]] = bounds;\n      const dx = x1 - x0;\n      const dy = y1 - y0;\n      const x = (x0 + x1) / 2;\n      const y = (y0 + y1) / 2;\n      const scale = Math.max(1, Math.min(8, 0.9 / Math.max(dx / width, dy / height)));\n      \n      // Apply the transform\n      svg.transition()\n        .duration(750)\n        .call(zoom.transform, d3.zoomIdentity\n          .translate(width / 2, height / 2)\n          .scale(scale)\n          .translate(-projection([x, y])[0], -projection([x, y])[1]));\n        \n      return; // Skip the regular bounds calculation\n    }\n    \n    // ... rest of existing fitToCountry code ...\n  }\n\n  function handleKeyboardNavigation(event) {\n    if (!isKeyboardModeEnabled) return;\n    \n    switch(event.key) {\n        case 'ArrowRight':\n        case 'ArrowLeft':\n            // Move focus to next/previous country\n            const countries = getVisibleCountries();\n            const currentIndex = countries.indexOf(currentFocus);\n            const nextIndex = event.key === 'ArrowRight' ? \n                (currentIndex + 1) % countries.length :\n                (currentIndex - 1 + countries.length) % countries.length;\n            setFocus(countries[nextIndex]);\n            break;\n            \n        case 'Enter':\n        case ' ': // Space\n            // Select currently focused country\n            selectCountry(currentFocus);\n            break;\n    }\n  }\n\n})(window, document)\n"]}